# 更新日志

## [v1.2.4] - 2025-01-27
- 优化搜索框显示逻辑，搜索框现在默认隐藏
- 只有在有筛选结果时才显示搜索框，提升用户体验
- 调整搜索框位置到统计信息和结果容器之间
- 新增toggleSearchControls方法控制搜索框的显示和隐藏

## [v1.2.3] - 2025-06-07
- 完成页面检查和代码清理工作
- 清理临时测试文件和开发文件
- 扩展双引号功能支持多字符字符串匹配
- 优化规则引擎核心匹配逻辑
- 修复字面量字符串长度计算问题
- 增强前缀后缀匹配功能

## [v1.2.2] - 2025-06-06
- 整理了相关功能和测试文档结构
- 完成全部主要页面的基础文字检查
- 优化项目文件组织结构

## [v1.2.1] - 2025-06-05
- 修复和完善详细语法帮助页面，统一运算符优先级、结合律、括号说明
- 修正所有已知文档BUG，细化排序规则与组合规则的用法说明

## [v1.2.0] - 2025-06-04

### 排序功能重新设计
- **多级排序顺序约束**：实现了完整的多级排序位置约束逻辑
  - 新增 `findMatchingSetElementWithPosition` 方法，支持从指定位置开始查找匹配元素
  - 确保后一级排序的匹配位置必须在前一级之后，避免位置重叠
  - 优化 `calculateGroupKeys` 方法，引入位置追踪机制
  - 改进排序处理逻辑，将无法满足约束的单词分离并合理处理

- **位置标识符功能完善**：修正和增强位置匹配功能
  - 修正 `~` 标识符实现，从"不包含匹配"改为"严格中间匹配"
  - 完善四种位置标识符的约束逻辑（^前缀、$后缀、*包含、~严格中间）
  - 更新语法帮助文档中的位置标识符说明和示例
  - 保持向后兼容性，原有API仍可正常使用

### 创建规则有效性检查完善
- **规则验证增强**：完善规则创建时的有效性检查机制
  - 改进规则解析和验证的错误处理
  - 提供更清晰的规则创建指导和错误提示
  - 增强用户体验，减少无效规则的创建

### 文档和代码整理
- **文档结构优化**：清理项目文档结构
  - 保留核心设计文档：《需求与规划整合.md》和《排序规则设计方案.md》
  - 删除冗余和过时的技术文档
  - 修正语法帮助页面中的示例注释

- **代码质量提升**：
  - 重构排序相关方法，提高代码可维护性
  - 添加详细的方法注释和参数说明
  - 优化错误处理和边界情况处理

### 技术改进
- **性能优化**：按元素长度降序排列，优先匹配较长的元素
- **错误容错**：提供完善的错误处理和回退机制
- **功能扩展**：为未来的排序功能扩展奠定基础

## [v1.1.9] - 2025-06-04

### 版本发布
- **代码整理**：整理项目代码结构，优化文件组织
- **版本管理**：更新版本号到v1.1.9，发布日期为2025年6月4日
- **文档更新**：同步更新VERSION文件和CHANGELOG.md
- **Git提交**：将所有更改提交到版本控制系统

### 技术改进
- **版本控制**：规范化版本发布流程
- **文档维护**：保持版本历史记录的完整性和准确性

## [v1.1.8] - 2025-06-03

### 首页功能完善
- **折叠展开功能优化**：全面改进筛选结果区的交互体验
  - 为排序标签添加折叠功能和三角箭头指示器
  - 修复所有层级（单层、双层）的三角按钮旋转问题
  - 改进按钮配色为纯黑色，在不同背景下都清晰可见
  - 调整按钮位置到标题最前方，实现垂直居中对齐
  - 采用CSS伪元素(::before)实现，简化HTML结构和JavaScript逻辑

- **删除恢复功能改进**：优化已删除单词的视觉表现
  - 移除恢复图标上的删除线，保持按钮文字清晰可读
  - 精确控制删除线仅显示在单词文本(.word-text)上
  - 保持红色背景、红色边框和半透明效果的视觉提示
  - 确保删除/恢复按钮的功能和样式正常工作

- **布局优化**：提升页面整体视觉效果和空间利用
  - 调整word-group div的下边距从25px减少到10px，布局更紧凑
  - 修复word-item在筛选结果较少时被拉伸填满整行的问题
  - 使用auto-fill替代auto-fit，max-content替代1fr确保单词项宽度一致
  - 优化响应式布局：窄屏最小160px，宽屏最小120px

### 用户体验提升
- **视觉一致性**：统一折叠按钮样式，避免▶和▼字符大小差异问题
- **交互稳定性**：保持所有折叠展开功能正常，仅优化视觉表现
- **布局整齐性**：解决单词项不规则拉伸，保持网格布局的整齐美观
- **响应式改进**：在不同屏幕尺寸下都能保持良好的显示效果

### 技术改进
- **CSS优化**：使用现代CSS Grid和Flexbox布局技术
- **代码简化**：减少HTML元素，提高渲染性能
- **兼容性**：确保在不同设备和屏幕尺寸下的一致体验

## [v1.1.7] - 2025-06-02

### 功能优化
- **分组拖拽功能移除**：简化界面交互，提升用户体验
  - 移除规则分组的拖拽移动功能，避免复杂的交互操作
  - 保留核心的单词显示分组功能（按首字母分组、按集合规则分组）
  - 清理相关的CSS样式和JavaScript拖拽处理代码
  - 移除分组标题拖拽、分组间拖拽排序等功能

### 代码质量提升
- **错误修复**：解决代码重构过程中产生的语法问题
  - 修复JavaScript中const变量重新赋值的TypeError错误
  - 修复CSS文件中孤立属性导致的语法错误
  - 清理无用的分组拖拽相关代码片段
  - 优化代码结构，提高可维护性

### 文档整理
- **项目文档更新**：完善项目文档体系
  - 整理v1.2.0开发规划文档
  - 更新需求与规划整合文档
  - 完善技术文档结构和索引
  - 更新版本信息和变更日志

### 技术改进
- **界面简化**：专注核心功能，减少不必要的复杂性
- **性能优化**：移除拖拽相关的事件监听器和DOM操作
- **维护性提升**：代码结构更清晰，便于后续开发和维护

## [v1.1.6] - 2025-06-01

### 功能修复
- **排序功能修复**：解决@-逆序排序功能无效的关键问题
  - 修复`groupWordsByFirstLetter`方法中@-逆序排序逻辑缺失的问题
  - 添加对@-和@排序规则的正确处理，确保两种规则产生不同的排序结果
  - 优化排序逻辑，正确调用`ruleEngine.applySorting`方法处理排序
  - 保持原有分组显示格式，仅改变组内单词的排序顺序

### 技术改进
- **代码优化**：提升系统稳定性和用户体验
  - 限制排序分级最多三级，防止过度复杂的排序规则
  - 完善排序规则解析和错误处理机制
  - 更新相关文档和注释说明，提高代码可维护性
  - 修改rule-manager.html中双辅音开头示例的注释2，明确排序层级限制

### 用户体验提升
- **排序功能增强**：用户现在可以正确使用@-规则获得逆序排列的单词列表
- **错误提示优化**：当排序规则超过两级时，系统会给出明确的错误提示

## [v1.1.5] - 2025-06-01

### 用户界面优化
- **规则管理页面增强**：提升大量规则管理的用户体验
  - 新增"收缩/展开全部"按钮，支持批量管理已保存规则的显示状态
  - 实现规则展开/收缩状态的本地持久化存储，页面刷新后保持用户设置
  - 优化规则项HTML结构，增加`data-rule-id`属性和`rule-item`容器支持
  - 修复CSS样式问题，确保`.rule-item.collapsed`状态下内容正确隐藏
  - 智能按钮文本显示：根据当前规则状态自动切换"收缩全部"/"展开全部"文本
  - 与现有单个规则收缩展开功能完全兼容，提供统一的交互体验

### 技术改进
- **JavaScript功能增强**：新增`toggleAllSavedRules()`、`updateToggleAllSavedButtonText()`和`restoreSavedRuleStates()`方法
- **CSS样式优化**：完善`.rule-item-content`的显示逻辑，支持`collapsed`类状态控制
- **数据持久化**：利用`localStorage`保存用户的规则展开/收缩偏好设置

### 涉及文件
- `rule-manager.html`：UI界面和功能逻辑的完整实现

## [v1.1.4] - 2025-06-01

### 问题修复
- **JavaScript语法错误修复**：解决关键的代码执行问题
  - 修复`ruleEngine.js`第875行的换行符转义语法错误
  - 解决"Invalid or unexpected token"浏览器错误
  - 修正`getRulePreview`函数中的字符串拼接格式问题
  - 确保所有JavaScript文件能够正常加载和执行
  - 消除因语法错误导致的`RuleEngine`和`versionElement`未定义错误

### 技术改进
- **代码稳定性提升**：修复核心JavaScript语法问题，确保应用正常运行
- **错误处理优化**：消除浏览器控制台中的语法错误提示

## [v1.1.3] - 2025-06-01

### 问题修复
- **规则预览同步问题修复**：彻底解决规则预览与规则管理页面数据不同步的问题
  - 修复规则预览中全局集合定义与规则管理不同步的核心问题
  - 在`showRulePreview()`函数中添加`loadSavedGlobalSets()`调用，确保每次显示预览时重新加载最新配置
  - 从`ruleEngine.js`的`loadDefaultSets()`函数中移除N集合的默认定义
  - 确保规则预览显示的全局集合与规则管理页面设置完全一致

- **滚动条位置重置功能**：提升筛选结果浏览体验
  - 修复更换筛选模式后预览区滚动条不自动重置到顶部的问题
  - 在`displayResults()`函数中添加`resultContainer.scrollTop = 0`重置逻辑
  - 确保每次生成新筛选结果时用户都能从顶部开始浏览

### 新增规则框优化
- **自动格式化功能**：显著改善代码输入体验
  - 实现粘贴事件监听器，在用户粘贴代码到规则编辑器时自动触发格式化
  - 解决从示例复制代码到新增规则框时出现的格式混乱问题
  - 使用`setTimeout`延迟10毫秒执行格式化，确保粘贴内容完全插入后再处理
  - 保留手动格式化按钮功能，提供双重格式化选择

### 技术改进
- **数据同步机制增强**：建立可靠的跨页面数据同步机制
- **用户体验优化**：改善代码输入、格式化和结果浏览的整体交互体验
- **数据一致性保障**：确保不同功能模块间的全局集合定义始终保持一致
- **代码质量提升**：优化事件处理逻辑，提高代码的可维护性和稳定性

### 涉及文件
- `js/app.js`：修复规则预览同步和滚动条重置问题
- `js/ruleEngine.js`：移除N集合默认定义，优化全局集合配置
- `rule-manager.html`：添加自动格式化功能

## [v1.1.2] - 2025-05-30

### 功能增强
- **规则示例区交互优化**：全面提升规则管理器示例区的用户体验
  - 新增"收缩/展开全部"按钮，支持一键操作所有示例区域
  - 实现智能响应式设计：当屏幕从宽屏切换到窄屏（≤768px）时自动收缩所有示例
  - 优化视觉布局：将示例间的垂直间距调整为0，提供更紧凑的显示效果
  - 修正示例内容错误：将"四字母及以上单词"示例中的三字母单词替换为符合规则的四字母单词
  - 智能状态同步：按钮文本根据当前示例展开/收缩状态自动更新
  - 保持持久化存储：用户的展开/收缩偏好设置在页面刷新后仍然保持

### 技术改进
- **JavaScript功能扩展**：
  - 新增`toggleAllExamples()`函数实现批量操作
  - 新增`updateToggleAllButtonText()`函数实现状态同步
  - 新增`handleResponsiveExamples()`函数实现响应式自动收缩
  - 新增`collapseAllExamples()`函数专门处理自动收缩逻辑
  - 添加窗口大小监听器，实时响应屏幕尺寸变化

### 用户体验提升
- **移动端优化**：在小屏设备上自动收缩示例，节省屏幕空间
- **操作便捷性**：一键操作替代逐个点击，提升操作效率
- **视觉一致性**：按钮样式与现有界面风格保持统一

## [v1.1.1] - 2025-05-30

### 界面优化
- **规则示例重构**：完全重新设计规则管理器中的示例展示格式
  - 调整示例顺序，将"四字母及以上单词"示例移至首位，更符合学习顺序
  - 统一使用"功能"、"语法"、"集合"、"示例"等标准化字段，提升信息结构化程度
  - 为每个规则添加具体的单词示例（如cat, dog, run, big等），便于理解和验证
  - 实现完整的代码语法高亮系统：
    - 注释行显示为绿色（#开头）
    - 集合定义显示为粉色（如BL=={...}）
    - 匹配规则显示为蓝色（如!LLLL）
    - 显示指令显示为黄色（@符号）
  - 采用深色代码背景（#2d3748），配合浅色文字，提升代码可读性
  - 优化代码布局，每行独立显示，使用等宽字体，增强视觉效果

### 用户体验提升
- **示例内容丰富化**：每个规则示例都包含8个具体单词，涵盖不同难度和类型
- **视觉层次优化**：使用粗体字段标签、适当的行间距和缩进，提升信息层次感
- **语法说明完善**：保留并优化重要的语法提示和注释，帮助用户掌握规则编写技巧
- **操作符展示增强**：组合规则中的&&、||、--操作符保持淡黄色背景，便于识别

### 技术改进
- **代码结构优化**：示例代码使用div结构替代纯文本，支持更丰富的样式控制
- **响应式设计**：确保新的示例格式在不同屏幕尺寸下都有良好的显示效果
- **可维护性提升**：标准化的字段结构便于后续示例的添加和修改

---

## [v1.1.0] - 2025-05-30

### 重大更新
- **项目整理**：清理了不必要的测试文件和临时文档，提升项目结构清晰度
  - 删除了 `test-non-operator.html` 测试页面（功能已集成到主应用）
  - 删除了 `docs/临时/` 文件夹及其中的 `.mht` 文件
  - 保留了 `debug.html` 作为开发调试工具

### 文档完善
- **开发实施计划更新**：标记已完成的核心功能，包括筛选结果预处理、规则注释和组合规则非模式
- **需求分析文档更新**：更新功能完成状态，为后续开发提供清晰的路线图
- **版本信息整理**：完善版本历史记录，提供详细的功能演进轨迹

### 已完成的核心功能总结
- ✅ **筛选结果预处理（删除）功能**：完整的单词删除、恢复和批量操作系统
- ✅ **规则注释功能**：支持60字符规则注释，大幅提升规则管理体验
- ✅ **组合规则非模式**：支持"--"操作符，实现"满足A但不满足B"的复杂逻辑
- ✅ **导出信息增强**：导出文件包含完整的源文件和规则信息，提升可追溯性

### 技术债务清理
- 移除了冗余的测试文件，减少项目维护负担
- 整理了文档结构，提升开发效率
- 为后续版本开发奠定了清晰的基础

---

## [v1.0.4] - 2025-05-30

### 新增功能
- **规则注释功能**：为筛选规则添加描述性注释，大幅提升规则管理体验
  - 在规则编辑器中新增注释输入框，支持最多60字符的注释
  - 规则列表中以优雅样式显示注释信息（淡蓝色边框，浅灰色背景）
  - 主页面规则选择下拉框显示注释预览（超过20字符自动截取并添加省略号）
  - 编辑规则时自动填入现有注释内容
  - 导出/导入规则功能完整支持注释信息
  - 注释采用 `//` 前缀，符合代码注释的视觉习惯

### 技术改进
- 扩展规则数据结构，新增 `comment` 字段
- 优化规则解析逻辑，支持注释行的识别和处理
- 完善文件存储功能，确保注释信息的完整保存和加载

---

## [v1.0.3] - 2025-05-30

### 核心功能
- **筛选结果预处理功能**：实现了完整的单词删除、恢复和清除功能
- 每个筛选结果单词旁添加删除/恢复按钮，支持精确的单词级操作
- 批量操作功能：全部删除、全部恢复、清除已删除单词
- 实时统计更新：动态显示已删除单词数量和有效单词数量
- 智能导出：导出时自动排除已删除单词，确保结果准确性

### UI/UX优化
- 修正预览区按钮间距问题：优化删除类与导出类按钮的分类间距
- 按钮颜色语义化：统一删除类按钮为灰色，编辑类按钮为蓝色，帮助类按钮为绿色
- 提升用户界面的可用性和视觉一致性

### 技术实现
- 新增deletedWords Set数据结构，高效管理删除状态
- 实现toggleWordDelete、deleteAllWords、restoreAllWords、clearDeleted等核心方法
- 扩展getActiveWords方法，支持获取有效（未删除）单词列表
- 优化消息提示系统，提供操作反馈

## [v1.0.2] - 2025-05-30

### 新增功能
- 导出信息增强：在导出文件头部添加完整的源文件信息、筛选规则信息和生成时间
- 支持TXT和Excel两种格式的头部信息显示
- 增强导出文件的可追溯性，便于用户管理和识别导出结果

### 功能优化
- 新增规则显示名称获取功能，导出时显示规则的友好名称
- 导出文件格式标准化，包含源文件名、总单词数、筛选规则、结果数量和生成时间
- Excel导出时调整列宽以适应头部信息显示

### 技术改进
- 扩展FileUtils的exportToText和exportToExcel方法，支持可选的导出信息参数
- 新增generateExportHeader方法，生成标准化的文件头部信息
- 在RuleEngine中添加getRuleName方法，获取规则的显示名称
- 保持向后兼容性，所有新增参数均为可选

### 导出格式示例
```
源文件：example.txt (总单词数：1000)
筛选规则：CVC规则 (筛选结果：500个单词)
生成时间：2025-05-30 14:30:25
===================================================
```

## [v1.0.1] - 2025-05-30

### 新增功能
- 导出功能增加文件保存路径选择，支持用户自定义保存位置和文件名
- 使用现代浏览器File System Access API提升用户体验
- 兼容性降级方案，确保在不支持新API的浏览器中正常工作

### 功能优化
- 优化用户取消导出操作时的提示逻辑，避免误导性成功提示
- 规则管理页面按钮布局优化，将导入导出按钮移至规则管理区域
- 修复导入规则数据持久化问题，确保导入的规则正确保存到localStorage

### 技术改进
- 完善错误处理机制，区分用户取消操作和实际错误
- 统一导出功能的异步处理逻辑
- 改进文件操作的用户体验和稳定性

### 涵盖的导出功能
- 主页导出为TXT文件
- 主页导出为Excel文件
- 主页导出规则文件
- 管理页导出规则文件

## [v1.0.0] - 2025-05-30

### 初始版本功能
- 支持自定义规则创建和管理
- 支持局部集合和全局集合定义
- 支持复杂的单词匹配模式（CVC、位置标记等）
- 支持文本文件上传和单词筛选
- 支持筛选结果排序和导出
- 独立的规则管理页面
- 规则导入导出功能
- 响应式设计，支持移动端
- 本地存储支持，数据持久化