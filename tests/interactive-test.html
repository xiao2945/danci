<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯ç­›é€‰å·¥å…· - åŠè‡ªåŠ¨åŒ–æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "ğŸ§ª";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .test-group {
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .test-group h3 {
            color: #34495e;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
        }

        .test-group h3::before {
            content: "âš™ï¸";
            margin-right: 8px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .example-box {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #0c5460;
        }

        .expected-result {
            background: #d1ecf1;
            border: 1px solid #b8daff;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            font-size: 13px;
            color: #004085;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .clear-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .output-section {
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
        }

        .output-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .output-title::before {
            content: "ğŸ“Š";
            margin-right: 10px;
        }

        .output-box {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            min-height: 200px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 400px;
        }

        .success {
            color: #27ae60;
        }

        .error {
            color: #e74c3c;
        }

        .warning {
            color: #f39c12;
        }

        .info {
            color: #3498db;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }
        }

        .tab-container {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>å•è¯ç­›é€‰å·¥å…·</h1>
            <p>åŠè‡ªåŠ¨åŒ–æµ‹è¯•é¡µé¢ - åŠŸèƒ½éªŒè¯ä¸æµ‹è¯•</p>
        </div>

        <div class="main-content">
            <!-- å·¦ä¾§æµ‹è¯•åŒºåŸŸ -->
            <div class="test-section">
                <div class="section-title">åŠŸèƒ½æµ‹è¯•åŒºåŸŸ</div>

                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('rule-engine')">è§„åˆ™å¼•æ“</button>
                    <button class="tab" onclick="switchTab('file-processing')">æ–‡ä»¶å¤„ç†</button>
                    <button class="tab" onclick="switchTab('result-display')">ç»“æœå±•ç¤º</button>
                    <button class="tab" onclick="switchTab('dataSync')">æ•°æ®åŒæ­¥</button>
                </div>

                <!-- è§„åˆ™å¼•æ“æµ‹è¯• -->
                <div id="rule-engine" class="tab-content active">
                    <div class="test-group">
                        <h3>é›†åˆå®šä¹‰ä¸å¼•ç”¨</h3>
                        <div class="input-group">
                            <label>é›†åˆå®šä¹‰è§„åˆ™:</label>
                            <textarea id="set-definition"
                                placeholder="è¾“å…¥é›†åˆå®šä¹‰è§„åˆ™...">BL == {bl,br,cl,cr,dr,fl,fr,gl,gr,pl,pr,sl,sp,st,tr}</textarea>
                            <div class="example-box">ç¤ºä¾‹: BL == {bl,br,cl,cr,dr,fl,fr,gl,gr,pl,pr,sl,sp,st,tr}</div>
                            <div class="expected-result">é¢„æœŸ: æˆåŠŸå®šä¹‰BLé›†åˆï¼ŒåŒ…å«æŒ‡å®šçš„åŒè¾…éŸ³ç»„åˆ</div>
                        </div>
                        <button class="test-button" onclick="testSetDefinition()">æµ‹è¯•é›†åˆå®šä¹‰</button>
                    </div>

                    <div class="test-group">
                        <h3>è§„åˆ™è¯­æ³•è§£æ</h3>
                        <div class="input-group">
                            <label>è§„åˆ™è¡¨è¾¾å¼:</label>
                            <textarea id="rule-expression" placeholder="è¾“å…¥è§„åˆ™è¡¨è¾¾å¼...">\b(BL)(V)</textarea>
                            <div class="example-box">ç¤ºä¾‹: \b(BL)(V) - åŒ¹é…ä»¥åŒè¾…éŸ³å¼€å¤´åè·Ÿå…ƒéŸ³çš„å•è¯</div>
                            <div class="expected-result">é¢„æœŸ: è§£ææˆåŠŸï¼Œè¯†åˆ«ä½ç½®æ ‡è®°å’Œé›†åˆå¼•ç”¨</div>
                        </div>
                        <div class="input-group">
                            <label>æµ‹è¯•å•è¯åˆ—è¡¨:</label>
                            <textarea id="test-words"
                                placeholder="è¾“å…¥æµ‹è¯•å•è¯ï¼Œç”¨é€—å·åˆ†éš”...">blue,black,tree,cat,dog,bright,clean</textarea>
                        </div>
                        <button class="test-button" onclick="testRuleParsing()">æµ‹è¯•è§„åˆ™è§£æ</button>
                    </div>

                    <div class="test-group">
                        <h3>ç»„åˆè§„åˆ™æµ‹è¯•</h3>
                        <div class="input-group">
                            <label>ç»„åˆè§„åˆ™:</label>
                            <textarea id="combo-rule" placeholder="è¾“å…¥ç»„åˆè§„åˆ™...">rule1 && rule2</textarea>
                            <div class="example-box">ç¤ºä¾‹: ::CVC||CVCE - æˆ–è¿ç®—ç»„åˆ</div>
                            <div class="expected-result">é¢„æœŸ: æ­£ç¡®æ‰§è¡Œé€»è¾‘è¿ç®—ï¼Œè¿”å›ç¬¦åˆæ¡ä»¶çš„å•è¯</div>
                        </div>
                        <button class="test-button" onclick="testComboRule()">æµ‹è¯•ç»„åˆè§„åˆ™</button>
                    </div>
                </div>

                <!-- æ–‡ä»¶å¤„ç†æµ‹è¯• -->
                <div id="file-processing" class="tab-content">
                    <div class="test-group">
                        <h3>æ–‡æœ¬é¢„å¤„ç†</h3>
                        <div class="input-group">
                            <label>åŸå§‹æ–‡æœ¬:</label>
                            <textarea id="raw-text"
                                placeholder="è¾“å…¥åŸå§‹æ–‡æœ¬...">hello[hÉ™ËˆloÊŠ]world[wÉœËrld] "test" data\nmore words</textarea>
                            <div class="example-box">ç¤ºä¾‹: hello[hÉ™ËˆloÊŠ]world[wÉœËrld] "test" data</div>
                            <div class="expected-result">é¢„æœŸ: éŸ³æ ‡åˆ†ç¦»ã€ç‰¹æ®Šå­—ç¬¦æ¸…ç†ã€å•è¯åˆ†å‰²</div>
                        </div>
                        <button class="test-button" onclick="testTextPreprocessing()">æµ‹è¯•æ–‡æœ¬é¢„å¤„ç†</button>
                    </div>

                    <div class="test-group">
                        <h3>å•è¯éªŒè¯</h3>
                        <div class="input-group">
                            <label>å•è¯åˆ—è¡¨:</label>
                            <textarea id="word-validation"
                                placeholder="è¾“å…¥å•è¯åˆ—è¡¨...">hello, [hÉ™ËˆloÊŠ], test123, a, verylongwordthatexceedslimit, cafÃ©</textarea>
                            <div class="example-box">ç¤ºä¾‹: hello, [hÉ™ËˆloÊŠ], test123, a, verylongword...</div>
                            <div class="expected-result">é¢„æœŸ: åŒºåˆ†æœ‰æ•ˆå•è¯ã€éŸ³æ ‡ã€æ— æ•ˆå•è¯</div>
                        </div>
                        <button class="test-button" onclick="testWordValidation()">æµ‹è¯•å•è¯éªŒè¯</button>
                    </div>

                    <div class="test-group">
                        <h3>å»é‡ç»Ÿè®¡</h3>
                        <div class="input-group">
                            <label>é‡å¤å•è¯åˆ—è¡¨:</label>
                            <textarea id="duplicate-words"
                                placeholder="è¾“å…¥åŒ…å«é‡å¤çš„å•è¯åˆ—è¡¨...">apple, Apple, APPLE, banana, apple, orange, Banana</textarea>
                            <div class="example-box">ç¤ºä¾‹: apple, Apple, APPLE, banana, apple</div>
                            <div class="expected-result">é¢„æœŸ: å»é‡å¹¶ç»Ÿè®¡é‡å¤æ•°é‡</div>
                        </div>
                        <button class="test-button" onclick="testDeduplication()">æµ‹è¯•å»é‡ç»Ÿè®¡</button>
                    </div>
                </div>

                <!-- ç»“æœå±•ç¤ºæµ‹è¯• -->
                <div id="result-display" class="tab-content">
                    <div class="test-group">
                        <h3>æŒ‰é¦–å­—æ¯åˆ†ç»„</h3>
                        <div class="input-group">
                            <label>å•è¯åˆ—è¡¨:</label>
                            <textarea id="alphabet-words"
                                placeholder="è¾“å…¥å•è¯åˆ—è¡¨...">apple, banana, cat, dog, elephant, fish, grape</textarea>
                            <div class="example-box">ç¤ºä¾‹: apple, banana, cat, dog, elephant</div>
                            <div class="expected-result">é¢„æœŸ: æŒ‰A-Zåˆ†ç»„å±•ç¤ºï¼Œæ˜¾ç¤ºæ¯ç»„å•è¯æ•°é‡</div>
                        </div>
                        <button class="test-button" onclick="testAlphabetGrouping()">æµ‹è¯•é¦–å­—æ¯åˆ†ç»„</button>
                    </div>

                    <div class="test-group">
                        <h3>äº¤äº’å¼ç®¡ç†</h3>
                        <div class="input-group">
                            <label>æ“ä½œç±»å‹:</label>
                            <select id="interaction-type">
                                <option value="delete">åˆ é™¤å•è¯</option>
                                <option value="restore">æ¢å¤å•è¯</option>
                                <option value="batch-delete">æ‰¹é‡åˆ é™¤</option>
                                <option value="batch-restore">æ‰¹é‡æ¢å¤</option>
                            </select>
                            <div class="expected-result">é¢„æœŸ: çŠ¶æ€åˆ‡æ¢ã€è§†è§‰åé¦ˆã€ç»Ÿè®¡æ›´æ–°</div>
                        </div>
                        <div class="input-group">
                            <label>ç›®æ ‡å•è¯:</label>
                            <input type="text" id="target-word" placeholder="è¾“å…¥è¦æ“ä½œçš„å•è¯..." value="apple">
                        </div>
                        <button class="test-button" onclick="testInteraction()">æµ‹è¯•äº¤äº’åŠŸèƒ½</button>
                    </div>

                    <div class="test-group">
                        <h3>æ•°æ®å¯¼å‡º</h3>
                        <div class="input-group">
                            <label>å¯¼å‡ºæ ¼å¼:</label>
                            <select id="export-format">
                                <option value="txt">TXTæ–‡æœ¬</option>
                                <option value="csv">CSVè¡¨æ ¼</option>
                                <option value="json">JSONæ•°æ®</option>
                            </select>
                            <div class="expected-result">é¢„æœŸ: ç”Ÿæˆå¯¹åº”æ ¼å¼çš„å¯¼å‡ºæ•°æ®</div>
                        </div>
                        <button class="test-button" onclick="testExport()">æµ‹è¯•æ•°æ®å¯¼å‡º</button>
                    </div>
                </div>

                <!-- æ•°æ®åŒæ­¥æµ‹è¯• -->
                <div id="dataSync" class="tab-content">
                    <div class="test-group">
                        <h3>localStorage å­˜å‚¨</h3>
                        <div class="input-group">
                            <label>è§„åˆ™åç§°:</label>
                            <input type="text" id="rule-name" placeholder="è¾“å…¥è§„åˆ™åç§°..." value="æµ‹è¯•è§„åˆ™">
                            <div class="example-box">ç¤ºä¾‹: æµ‹è¯•è§„åˆ™</div>
                            <div class="expected-result">é¢„æœŸ: è§„åˆ™æˆåŠŸä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</div>
                        </div>
                        <div class="input-group">
                            <label>è§„åˆ™å†…å®¹:</label>
                            <textarea id="rule-content" placeholder="è¾“å…¥è§„åˆ™å†…å®¹...">V
# æ³¨é‡Š: åŒ¹é…å…ƒéŸ³å¼€å¤´çš„å•è¯</textarea>
                        </div>
                        <button class="test-button" onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
                    </div>

                    <div class="test-group">
                        <h3>æ–‡ä»¶å¯¼å…¥å¯¼å‡º</h3>
                        <div class="input-group">
                            <label>å¯¼å‡ºæ•°æ®:</label>
                            <select id="export-type">
                                <option value="rules">è§„åˆ™æ•°æ®</option>
                                <option value="globalSets">å…¨å±€é›†åˆ</option>
                                <option value="all">å®Œæ•´æ•°æ®</option>
                            </select>
                            <div class="expected-result">é¢„æœŸ: ç”Ÿæˆå¯¹åº”æ ¼å¼çš„JSONæ–‡ä»¶</div>
                        </div>
                        <button class="test-button" onclick="testFileExport()">æµ‹è¯•æ–‡ä»¶å¯¼å‡º</button>
                    </div>

                    <div class="test-group">
                        <h3>è·¨é¡µé¢åŒæ­¥</h3>
                        <div class="input-group">
                            <label>åŒæ­¥æµ‹è¯•:</label>
                            <input type="text" id="sync-data" placeholder="è¾“å…¥åŒæ­¥æ•°æ®..." value="æ–°è§„åˆ™æ•°æ®">
                            <div class="example-box">ç¤ºä¾‹: ä¿®æ”¹æ•°æ®åæ£€æŸ¥å…¶ä»–é¡µé¢åŒæ­¥</div>
                            <div class="expected-result">é¢„æœŸ: æ•°æ®åœ¨å¤šä¸ªé¡µé¢é—´ä¿æŒä¸€è‡´</div>
                        </div>
                        <button class="test-button" onclick="testCrossPageSync()">æµ‹è¯•è·¨é¡µé¢åŒæ­¥</button>
                    </div>
                </div>

                <button class="test-button clear-button" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
            </div>

            <!-- å³ä¾§å‚è€ƒåŒºåŸŸ -->
            <div class="test-section">
                <div class="section-title">å‚è€ƒä¿¡æ¯</div>

                <div class="test-group">
                    <h3>å†…ç½®é›†åˆ</h3>
                    <div class="example-box">
                        C (è¾…éŸ³): b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z
                        V (å…ƒéŸ³): a,e,i,o,u
                        L (å­—æ¯): a-zå®Œæ•´å­—æ¯è¡¨
                        BL (åŒè¾…éŸ³): bl,br,cl,cr,dr,fl,fr,gl,gr,pl,pr,sl,sp,st,tr
                    </div>
                </div>

                <div class="test-group">
                    <h3>è§„åˆ™è¯­æ³•</h3>
                    <div class="example-box">
                        ä½ç½®æ ‡è®°:
                        \b - å•è¯å¼€å¤´
                        \e - å•è¯ç»“å°¾

                        é›†åˆå¼•ç”¨:
                        (C) - å¼•ç”¨é›†åˆC
                        [e] - å­—é¢å­—ç¬¦e

                        é€»è¾‘è¿ç®—:
                        && - ä¸è¿ç®—
                        || - æˆ–è¿ç®—
                        ~ - å–å
                        ! - å·®é›†
                    </div>
                </div>

                <div class="test-group">
                    <h3>æ’åºæ ‡è¯†ç¬¦</h3>
                    <div class="example-box">
                        ^ - å‰ç¼€åŒ¹é… (å¼€å¤´)
                        $ - åç¼€åŒ¹é… (ç»“å°¾)
                        * - ä»»æ„ä½ç½®åŒ¹é…
                        ~ - ä¸¥æ ¼ä¸­é—´åŒ¹é…
                        - - é€†åºæ ‡å¿—

                        ç¤ºä¾‹:
                        @V^ - å…ƒéŸ³å¼€å¤´
                        @C$ - è¾…éŸ³ç»“å°¾
                        @(BL^)(V*) - åŒè¾…éŸ³å¼€å¤´+åŒ…å«å…ƒéŸ³
                    </div>
                </div>

                <div class="test-group">
                    <h3>æ–‡ä»¶æ ¼å¼æ”¯æŒ</h3>
                    <div class="example-box">
                        æ”¯æŒæ ¼å¼:
                        - TXTæ–‡æœ¬æ–‡ä»¶ (UTF-8)
                        - Excelæ–‡ä»¶ (.xlsx, .xls)
                        - CSVæ–‡ä»¶

                        æ–‡ä»¶å¤§å°é™åˆ¶: 10MB

                        éŸ³æ ‡æ ¼å¼: word[phonetic]
                        ç‰¹æ®Šå­—ç¬¦: è‡ªåŠ¨æ¸…ç†å¼•å·ã€åæ–œæ ç­‰
                    </div>
                </div>
            </div>
        </div>

        <!-- è¾“å‡ºåŒºåŸŸ -->
        <div class="output-section">
            <div class="output-title">æµ‹è¯•è¾“å‡ºç»“æœ</div>
            <div id="output" class="output-box">ç­‰å¾…æµ‹è¯•è¾“å…¥...

                ä½¿ç”¨è¯´æ˜:
                1. é€‰æ‹©åŠŸèƒ½æ¨¡å—æ ‡ç­¾é¡µ
                2. å¡«å†™æµ‹è¯•è¾“å…¥æ•°æ®
                3. ç‚¹å‡»å¯¹åº”çš„æµ‹è¯•æŒ‰é’®
                4. æŸ¥çœ‹è¾“å‡ºç»“æœå’ŒçŠ¶æ€

                æ”¯æŒçš„æµ‹è¯•åŠŸèƒ½:
                âœ“ è§„åˆ™å¼•æ“ - é›†åˆå®šä¹‰ã€è§„åˆ™è§£æã€ç»„åˆè§„åˆ™
                âœ“ æ–‡ä»¶å¤„ç† - æ–‡æœ¬é¢„å¤„ç†ã€å•è¯éªŒè¯ã€å»é‡ç»Ÿè®¡
                âœ“ ç»“æœå±•ç¤º - åˆ†ç»„æ˜¾ç¤ºã€äº¤äº’ç®¡ç†ã€æ•°æ®å¯¼å‡º
                âœ“ æ’åºè§„åˆ™ - ä½ç½®æ ‡è¯†ç¬¦ã€å¤šçº§æ’åºã€é€†åºæ’åº</div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿçš„æ ¸å¿ƒåŠŸèƒ½ç±»
        class MockRuleEngine {
            constructor() {
                this.sets = {
                    'C': ['b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm', 'n', 'p', 'q', 'r', 's', 't', 'v', 'w', 'x', 'y', 'z'],
                    'V': ['a', 'e', 'i', 'o', 'u'],
                    'L': 'abcdefghijklmnopqrstuvwxyz'.split('')
                };
                this.customSets = {};
            }

            defineSet(definition) {
                const match = definition.match(/(\w+)\s*==\s*\{([^}]+)\}/);
                if (match) {
                    const [, name, content] = match;
                    this.customSets[name] = content.split(',').map(s => s.trim());
                    return { success: true, name, content: this.customSets[name] };
                }
                return { success: false, error: 'é›†åˆå®šä¹‰æ ¼å¼é”™è¯¯' };
            }

            parseRule(rule) {
                const positions = rule.match(/\\b|\\e/g) || [];
                const sets = rule.match(/\((\w+)\)/g) || [];
                const literals = rule.match(/\[([^\]]+)\]/g) || [];

                return {
                    success: true,
                    positions: positions,
                    sets: sets.map(s => s.replace(/[()]/g, '')),
                    literals: literals.map(s => s.replace(/[\[\]]/g, '')),
                    pattern: rule
                };
            }

            matchWords(rule, words) {
                // ç®€åŒ–çš„åŒ¹é…é€»è¾‘
                const parsed = this.parseRule(rule);
                const results = [];

                words.forEach(word => {
                    let matches = false;

                    // ç®€å•çš„æ¨¡å¼åŒ¹é…ç¤ºä¾‹
                    if (rule.includes('(BL)') && rule.includes('(V)')) {
                        const blPatterns = ['bl', 'br', 'cl', 'cr', 'dr', 'fl', 'fr', 'gl', 'gr', 'pl', 'pr', 'sl', 'sp', 'st', 'tr'];
                        const vowels = ['a', 'e', 'i', 'o', 'u'];

                        for (let bl of blPatterns) {
                            if (word.toLowerCase().startsWith(bl)) {
                                for (let v of vowels) {
                                    if (word.toLowerCase().includes(v)) {
                                        matches = true;
                                        break;
                                    }
                                }
                                if (matches) break;
                            }
                        }
                    }

                    if (matches) {
                        results.push(word);
                    }
                });

                return results;
            }
        }

        class MockFileProcessor {
            preprocessText(text) {
                // éŸ³æ ‡æ ¼å¼å¤„ç†
                let processed = text.replace(/([a-zA-ZÃ€-Ã¿'.-]+)(\[[^\]]+\])/g, '$1 $2');

                // ç‰¹æ®Šå­—ç¬¦æ¸…ç†
                processed = processed.replace(/["\\ã€]/g, ' ');

                // å•è¯åˆ†å‰²
                const words = processed.split(/[\s,;]+/).filter(w => w.trim());

                return {
                    original: text,
                    processed: processed,
                    words: words,
                    steps: [
                        'éŸ³æ ‡æ ¼å¼å¤„ç†: word[phonetic] â†’ word [phonetic]',
                        'ç‰¹æ®Šå­—ç¬¦æ¸…ç†: ç§»é™¤å¼•å·ã€åæ–œæ ç­‰',
                        'å•è¯åˆ†å‰²: ä½¿ç”¨ç©ºæ ¼ã€é€—å·ã€åˆ†å·åˆ†å‰²'
                    ]
                };
            }

            validateWords(words) {
                const results = {
                    valid: [],
                    invalid: [],
                    phonetics: []
                };

                words.forEach(word => {
                    if (word.match(/^\[[^\]]+\]$/)) {
                        results.phonetics.push(word);
                    } else if (word.match(/^[a-zA-ZÃ€-Ã¿'.-]+$/) && word.length >= 1 && word.length <= 50) {
                        results.valid.push(word);
                    } else {
                        results.invalid.push(word);
                    }
                });

                return results;
            }

            deduplicateWords(words) {
                const seen = new Set();
                const unique = [];
                const duplicates = [];

                words.forEach(word => {
                    const lower = word.toLowerCase();
                    if (seen.has(lower)) {
                        duplicates.push(word);
                    } else {
                        seen.add(lower);
                        unique.push(word);
                    }
                });

                return {
                    unique: unique,
                    duplicates: duplicates,
                    total: words.length,
                    uniqueCount: unique.length,
                    duplicateCount: duplicates.length
                };
            }
        }

        class MockResultDisplay {
            groupByAlphabet(words) {
                const groups = {};

                words.forEach(word => {
                    const first = word.charAt(0).toUpperCase();
                    if (!groups[first]) {
                        groups[first] = [];
                    }
                    groups[first].push(word);
                });

                return groups;
            }

            simulateInteraction(type, word) {
                const actions = {
                    'delete': `å•è¯ "${word}" å·²æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€`,
                    'restore': `å•è¯ "${word}" å·²æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€`,
                    'batch-delete': 'æ‰¹é‡åˆ é™¤æ“ä½œå·²æ‰§è¡Œ',
                    'batch-restore': 'æ‰¹é‡æ¢å¤æ“ä½œå·²æ‰§è¡Œ'
                };

                return {
                    action: type,
                    target: word,
                    message: actions[type] || 'æœªçŸ¥æ“ä½œ',
                    timestamp: new Date().toLocaleString()
                };
            }

            exportData(words, format) {
                switch (format) {
                    case 'txt':
                        return words.join('\n');
                    case 'csv':
                        return 'Word,Length\n' + words.map(w => `${w},${w.length}`).join('\n');
                    case 'json':
                        return JSON.stringify(words.map(w => ({ word: w, length: w.length })), null, 2);
                    default:
                        return words.join(', ');
                }
            }
        }

        class MockSortingEngine {
            parsePositionIdentifier(rule) {
                const identifiers = {
                    '^': 'å‰ç¼€åŒ¹é…',
                    '$': 'åç¼€åŒ¹é…',
                    '*': 'ä»»æ„ä½ç½®',
                    '~': 'ä¸¥æ ¼ä¸­é—´'
                };

                const matches = rule.match(/@([\w\^\$\*\~\(\)\-]+)/g) || [];
                return matches.map(match => {
                    const clean = match.replace('@', '');
                    return {
                        original: match,
                        cleaned: clean,
                        type: this.getIdentifierType(clean)
                    };
                });
            }

            getIdentifierType(identifier) {
                if (identifier.includes('^')) return 'å‰ç¼€åŒ¹é…';
                if (identifier.includes('$')) return 'åç¼€åŒ¹é…';
                if (identifier.includes('*')) return 'ä»»æ„ä½ç½®';
                if (identifier.includes('~')) return 'ä¸¥æ ¼ä¸­é—´';
                return 'é»˜è®¤å‰ç¼€';
            }

            applySorting(words, rule) {
                const groups = {};
                const identifiers = this.parsePositionIdentifier(rule);

                // ç®€åŒ–çš„æ’åºé€»è¾‘
                if (rule.includes('V^')) {
                    const vowels = ['a', 'e', 'i', 'o', 'u'];
                    vowels.forEach(v => {
                        groups[v] = words.filter(word => word.toLowerCase().startsWith(v));
                    });
                    groups['å…¶ä»–'] = words.filter(word => !vowels.includes(word.toLowerCase().charAt(0)));
                }

                return {
                    groups: groups,
                    identifiers: identifiers,
                    rule: rule
                };
            }
        }

        // å…¨å±€å®ä¾‹
        const ruleEngine = new MockRuleEngine();
        const fileProcessor = new MockFileProcessor();
        const resultDisplay = new MockResultDisplay();
        const sortingEngine = new MockSortingEngine();

        // è¾“å‡ºå‡½æ•°
        function output(message, type = 'info') {
            const outputElement = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;

            const formattedMessage = `[${timestamp}] ${message}`;
            outputElement.innerHTML += `<span class="${className}">${formattedMessage}</span>\n`;
            outputElement.scrollTop = outputElement.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = 'è¾“å‡ºå·²æ¸…ç©º...\n';
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');

            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // æµ‹è¯•å‡½æ•°
        function testSetDefinition() {
            const definition = document.getElementById('set-definition').value;
            output(`æµ‹è¯•é›†åˆå®šä¹‰: ${definition}`, 'info');

            const result = ruleEngine.defineSet(definition);
            if (result.success) {
                output(`âœ“ é›†åˆå®šä¹‰æˆåŠŸ: ${result.name} = [${result.content.join(', ')}]`, 'success');
            } else {
                output(`âœ— é›†åˆå®šä¹‰å¤±è´¥: ${result.error}`, 'error');
            }
        }

        function testRuleParsing() {
            const rule = document.getElementById('rule-expression').value;
            const words = document.getElementById('test-words').value.split(',').map(w => w.trim());

            output(`æµ‹è¯•è§„åˆ™è§£æ: ${rule}`, 'info');
            output(`æµ‹è¯•å•è¯: [${words.join(', ')}]`, 'info');

            const parsed = ruleEngine.parseRule(rule);
            output(`âœ“ è§„åˆ™è§£æç»“æœ:`, 'success');
            output(`  ä½ç½®æ ‡è®°: [${parsed.positions.join(', ')}]`, 'info');
            output(`  é›†åˆå¼•ç”¨: [${parsed.sets.join(', ')}]`, 'info');
            output(`  å­—é¢å­—ç¬¦: [${parsed.literals.join(', ')}]`, 'info');

            const matches = ruleEngine.matchWords(rule, words);
            output(`âœ“ åŒ¹é…ç»“æœ: [${matches.join(', ')}]`, 'success');
        }

        function testComboRule() {
            const rule = document.getElementById('combo-rule').value;
            output(`æµ‹è¯•ç»„åˆè§„åˆ™: ${rule}`, 'info');

            // æ¨¡æ‹Ÿç»„åˆè§„åˆ™å¤„ç†
            if (rule.includes('&&')) {
                output(`âœ“ æ£€æµ‹åˆ°ä¸è¿ç®— (&&)`, 'success');
            } else if (rule.includes('||')) {
                output(`âœ“ æ£€æµ‹åˆ°æˆ–è¿ç®— (||)`, 'success');
            } else if (rule.includes('~')) {
                output(`âœ“ æ£€æµ‹åˆ°å–åè¿ç®— (~)`, 'success');
            } else if (rule.includes('!')) {
                output(`âœ“ æ£€æµ‹åˆ°å·®é›†è¿ç®— (!)`, 'success');
            }

            output(`ç»„åˆè§„åˆ™è§£æå®Œæˆ`, 'info');
        }

        function testTextPreprocessing() {
            const text = document.getElementById('raw-text').value;
            output(`æµ‹è¯•æ–‡æœ¬é¢„å¤„ç†: ${text}`, 'info');

            const result = fileProcessor.preprocessText(text);
            output(`âœ“ é¢„å¤„ç†å®Œæˆ:`, 'success');
            output(`  åŸå§‹æ–‡æœ¬: ${result.original}`, 'info');
            output(`  å¤„ç†å: ${result.processed}`, 'info');
            output(`  æå–å•è¯: [${result.words.join(', ')}]`, 'info');
            output(`  å¤„ç†æ­¥éª¤:`, 'info');
            result.steps.forEach(step => output(`    - ${step}`, 'info'));
        }

        function testWordValidation() {
            const words = document.getElementById('word-validation').value.split(',').map(w => w.trim());
            output(`æµ‹è¯•å•è¯éªŒè¯: [${words.join(', ')}]`, 'info');

            const result = fileProcessor.validateWords(words);
            output(`âœ“ éªŒè¯å®Œæˆ:`, 'success');
            output(`  æœ‰æ•ˆå•è¯ (${result.valid.length}): [${result.valid.join(', ')}]`, 'success');
            output(`  éŸ³æ ‡æ ¼å¼ (${result.phonetics.length}): [${result.phonetics.join(', ')}]`, 'warning');
            output(`  æ— æ•ˆå•è¯ (${result.invalid.length}): [${result.invalid.join(', ')}]`, 'error');
        }

        function testDeduplication() {
            const words = document.getElementById('duplicate-words').value.split(',').map(w => w.trim());
            output(`æµ‹è¯•å»é‡ç»Ÿè®¡: [${words.join(', ')}]`, 'info');

            const result = fileProcessor.deduplicateWords(words);
            output(`âœ“ å»é‡å®Œæˆ:`, 'success');
            output(`  æ€»å•è¯æ•°: ${result.total}`, 'info');
            output(`  å”¯ä¸€å•è¯æ•°: ${result.uniqueCount}`, 'success');
            output(`  é‡å¤å•è¯æ•°: ${result.duplicateCount}`, 'warning');
            output(`  å”¯ä¸€å•è¯: [${result.unique.join(', ')}]`, 'success');
            output(`  é‡å¤å•è¯: [${result.duplicates.join(', ')}]`, 'warning');
        }

        function testAlphabetGrouping() {
            const words = document.getElementById('alphabet-words').value.split(',').map(w => w.trim());
            output(`æµ‹è¯•é¦–å­—æ¯åˆ†ç»„: [${words.join(', ')}]`, 'info');

            const groups = resultDisplay.groupByAlphabet(words);
            output(`âœ“ åˆ†ç»„å®Œæˆ:`, 'success');

            Object.keys(groups).sort().forEach(letter => {
                output(`  ${letter}ç»„ (${groups[letter].length}ä¸ª): [${groups[letter].join(', ')}]`, 'info');
            });
        }

        function testInteraction() {
            const type = document.getElementById('interaction-type').value;
            const word = document.getElementById('target-word').value;

            output(`æµ‹è¯•äº¤äº’åŠŸèƒ½: ${type} - ${word}`, 'info');

            const result = resultDisplay.simulateInteraction(type, word);
            output(`âœ“ ${result.message}`, 'success');
            output(`  æ“ä½œæ—¶é—´: ${result.timestamp}`, 'info');
        }

        function testExport() {
            const format = document.getElementById('export-format').value;
            const words = ['apple', 'banana', 'cat', 'dog'];

            output(`æµ‹è¯•æ•°æ®å¯¼å‡º: ${format.toUpperCase()}æ ¼å¼`, 'info');

            const exported = resultDisplay.exportData(words, format);
            output(`âœ“ å¯¼å‡ºå®Œæˆ:`, 'success');
            output(`${exported}`, 'info');
        }

        function testLocalStorage() {
            const ruleName = document.getElementById('rule-name').value;
            const ruleContent = document.getElementById('rule-content').value;

            output(`æµ‹è¯•æœ¬åœ°å­˜å‚¨: ä¿å­˜è§„åˆ™ "${ruleName}"`, 'info');

            try {
                // æ¨¡æ‹ŸlocalStorageä¿å­˜
                const ruleData = {
                    name: ruleName,
                    comment: ruleContent.includes('#') ? ruleContent.split('#')[1].trim() : '',
                    specificRule: ruleContent.split('#')[0].trim(),
                    displayRule: ruleContent.includes('@') ? ruleContent.match(/@[^\n]+/)[0] : '',
                    localSets: []
                };

                // æ¨¡æ‹Ÿä¿å­˜åˆ°localStorage
                output('ä¿å­˜åˆ°localStorage:', 'success');
                output(`  é”®: wordFilterRules`, 'info');
                output(`  å€¼: {..."${ruleName}": ${JSON.stringify(ruleData, null, 2)}}`, 'info');

                // æ¨¡æ‹ŸéªŒè¯æ•°æ®å®Œæ•´æ€§
                const validationResult = validateRuleData(ruleData);
                if (validationResult.valid) {
                    output('æ•°æ®éªŒè¯é€šè¿‡', 'success');
                } else {
                    output(`æ•°æ®éªŒè¯å¤±è´¥: ${validationResult.error}`, 'warning');
                }
            } catch (error) {
                output(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function testFileExport() {
            const exportType = document.getElementById('export-type').value;

            output(`æµ‹è¯•æ–‡ä»¶å¯¼å‡º: ${exportType}`, 'info');

            try {
                // æ¨¡æ‹Ÿæ–‡ä»¶å¯¼å‡º
                let exportData = {};

                if (exportType === 'rules' || exportType === 'all') {
                    exportData.rules = {
                        'ç¤ºä¾‹è§„åˆ™1': {
                            name: 'ç¤ºä¾‹è§„åˆ™1',
                            comment: 'å…ƒéŸ³å¼€å¤´',
                            specificRule: 'V',
                            displayRule: '@V'
                        },
                        'ç¤ºä¾‹è§„åˆ™2': {
                            name: 'ç¤ºä¾‹è§„åˆ™2',
                            comment: 'è¾…éŸ³ç»“å°¾',
                            specificRule: 'C$',
                            displayRule: '@C$'
                        }
                    };
                }

                if (exportType === 'globalSets' || exportType === 'all') {
                    exportData.globalSets = {
                        'å…ƒéŸ³': ['a', 'e', 'i', 'o', 'u'],
                        'è¾…éŸ³': ['b', 'c', 'd', 'f', 'g']
                    };
                }

                // è¾“å‡ºå¯¼å‡ºç»“æœ
                output('å¯¼å‡ºæ–‡ä»¶å†…å®¹:', 'success');
                output(JSON.stringify(exportData, null, 2), 'info');
                output('æ–‡ä»¶å¯¼å‡ºæˆåŠŸ: rules-export.json', 'success');
            } catch (error) {
                output(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function testCrossPageSync() {
            const syncData = document.getElementById('sync-data').value;

            output(`æµ‹è¯•è·¨é¡µé¢åŒæ­¥: "${syncData}"`, 'info');

            try {
                // æ¨¡æ‹Ÿè·¨é¡µé¢åŒæ­¥
                output('åŒæ­¥è¿‡ç¨‹:', 'success');
                output('  1. é¡µé¢Aä¿®æ”¹æ•°æ®', 'info');
                output(`  2. è§¦å‘storageäº‹ä»¶: key=wordFilterRules, newValue=${syncData}`, 'info');
                output('  3. é¡µé¢Bæ¥æ”¶åˆ°storageäº‹ä»¶', 'info');
                output('  4. é¡µé¢Bæ›´æ–°æœ¬åœ°æ•°æ®', 'info');
                output('  5. é¡µé¢Båˆ·æ–°ç•Œé¢æ˜¾ç¤º', 'info');

                // æ¨¡æ‹Ÿå†²çªå¤„ç†
                output('å†²çªå¤„ç†æ¼”ç¤º:', 'info');
                output('  é¡µé¢Aæ—¶é—´æˆ³: 2023-05-10T10:15:30', 'info');
                output('  é¡µé¢Bæ—¶é—´æˆ³: 2023-05-10T10:15:45', 'info');
                output('  ç»“æœ: é‡‡ç”¨é¡µé¢Bçš„æ›´æ–°ï¼ˆæ›´æ–°æ—¶é—´æˆ³ï¼‰', 'success');
            } catch (error) {
                output(`é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // è¾…åŠ©å‡½æ•°
        function validateRuleData(ruleData) {
            if (!ruleData.name) {
                return { valid: false, error: 'è§„åˆ™åç§°ä¸èƒ½ä¸ºç©º' };
            }
            if (!ruleData.specificRule) {
                return { valid: false, error: 'è§„åˆ™å†…å®¹ä¸èƒ½ä¸ºç©º' };
            }
            return { valid: true };
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            output('åŠè‡ªåŠ¨åŒ–æµ‹è¯•é¡µé¢å·²åŠ è½½å®Œæˆ', 'success');
            output('è¯·é€‰æ‹©åŠŸèƒ½æ¨¡å—å¼€å§‹æµ‹è¯•', 'info');
        });
    </script>
</body>

</html>