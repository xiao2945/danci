<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试页面 - 检查规则数据</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
        }
    </style>
</head>

<body>
    <h1>规则数据调试页面</h1>

    <div class="section">
        <h2>localStorage 中的规则数据</h2>
        <button onclick="checkRules()">检查规则</button>
        <button onclick="clearRules()">清空规则</button>
        <pre id="rulesData">点击"检查规则"按钮查看数据</pre>
    </div>

    <div class="section">
        <h2>RuleEngine 测试</h2>
        <button onclick="testRuleEngine()">测试 RuleEngine</button>
        <pre id="ruleEngineTest">点击"测试 RuleEngine"按钮查看结果</pre>
    </div>

    <script src="js/fileUtils.js"></script>
    <script src="js/fileStorage.js"></script>
    <script src="js/ruleEngine.js"></script>

    <script>
        function checkRules() {
            const rulesData = localStorage.getItem('wordFilterRules');
            const ruleOrder = localStorage.getItem('ruleOrder');
            const globalSets = localStorage.getItem('globalSets');

            const output = {
                wordFilterRules: rulesData ? JSON.parse(rulesData) : null,
                ruleOrder: ruleOrder ? JSON.parse(ruleOrder) : null,
                globalSets: globalSets ? JSON.parse(globalSets) : null
            };

            document.getElementById('rulesData').textContent = JSON.stringify(output, null, 2);
        }

        function clearRules() {
            if (confirm('确定要清空所有规则数据吗？')) {
                localStorage.removeItem('wordFilterRules');
                localStorage.removeItem('ruleOrder');
                localStorage.removeItem('globalSets');
                alert('规则数据已清空');
                checkRules();
            }
        }

        function testRuleEngine() {
            try {
                const ruleEngine = new RuleEngine();
                ruleEngine.loadSavedRules();
                const ruleNames = ruleEngine.getRuleNames();

                const output = {
                    ruleNames: ruleNames,
                    rulesCount: ruleNames.length,
                    globalSets: Array.from(ruleEngine.getGlobalSets().keys())
                };

                document.getElementById('ruleEngineTest').textContent = JSON.stringify(output, null, 2);
            } catch (error) {
                document.getElementById('ruleEngineTest').textContent = 'Error: ' + error.message;
            }
        }

        // 页面加载时自动检查
        window.addEventListener('load', () => {
            checkRules();
            testRuleEngine();
        });
    </script>
</body>

</html>