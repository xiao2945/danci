# 单词筛选工具匹配规则技术文档

## 文档概述
本文档详细说明单词筛选工具中的各种匹配规则机制，包括基础规则、组合规则、特殊标记等，并提供完整的使用范例。

## 基础匹配规则

### 1. 字符集合匹配

#### 基本语法
- `[abc]` - 匹配字符a、b或c中的任意一个
- `[a-z]` - 匹配小写字母a到z中的任意一个
- `[A-Z]` - 匹配大写字母A到Z中的任意一个
- `[0-9]` - 匹配数字0到9中的任意一个

#### 组合使用
- `[a-zA-Z]` - 匹配任意字母
- `[a-zA-Z0-9]` - 匹配字母或数字
- `[aeiou]` - 匹配元音字母
- `[bcdfg...]` - 匹配辅音字母

#### 范例
```javascript
// 匹配包含元音字母的单词
{
  name: "包含元音",
  code: "word.includes('[aeiou]')"
}

// 匹配以大写字母开头的单词
{
  name: "首字母大写",
  code: "word[0].match('[A-Z]')"
}
```

### 2. 长度限制规则

#### 基本语法
- `word.length === n` - 精确长度匹配
- `word.length >= n` - 最小长度
- `word.length <= n` - 最大长度
- `word.length >= m && word.length <= n` - 长度范围

#### 范例
```javascript
// 3-5字母单词
{
  name: "中等长度单词",
  code: "word.length >= 3 && word.length <= 5"
}

// 长单词（8字母以上）
{
  name: "长单词",
  code: "word.length >= 8"
}
```

## 位置匹配规则

### 1. \m 标记（中间匹配）
**功能：** 匹配单词中间位置的字符或模式

#### 语法
- `\m[pattern]` - 在单词中间查找指定模式
- `\m{position}[pattern]` - 在指定位置查找模式

#### 实现逻辑
```javascript
// 伪代码实现
function matchMiddle(word, pattern) {
  const middleStart = Math.floor(word.length / 4);
  const middleEnd = Math.ceil(word.length * 3 / 4);
  const middlePart = word.slice(middleStart, middleEnd);
  return middlePart.includes(pattern);
}
```

#### 范例
```javascript
// 中间包含"ing"的单词
{
  name: "中间含ing",
  code: "\\m[ing]"
}

// 结果：running, singing, bringing 等
```

### 2. \-b 标记（词首匹配）
**功能：** 匹配单词开头的字符或模式

#### 语法
- `\-b[pattern]` - 单词必须以指定模式开头
- `\-b{n}[pattern]` - 前n个字符中包含模式

#### 实现逻辑
```javascript
// 伪代码实现
function matchBeginning(word, pattern) {
  return word.startsWith(pattern);
}
```

#### 范例
```javascript
// 以"pre"开头的单词
{
  name: "pre前缀",
  code: "\\-b[pre]"
}

// 结果：prepare, present, previous 等
```

### 3. \-e 标记（词尾匹配）
**功能：** 匹配单词结尾的字符或模式

#### 语法
- `\-e[pattern]` - 单词必须以指定模式结尾
- `\-e{n}[pattern]` - 后n个字符中包含模式

#### 实现逻辑
```javascript
// 伪代码实现
function matchEnding(word, pattern) {
  return word.endsWith(pattern);
}
```

#### 范例
```javascript
// 以"tion"结尾的单词
{
  name: "tion后缀",
  code: "\\-e[tion]"
}

// 结果：information, education, creation 等
```

## 组合规则

### 1. && 操作符（与逻辑）
**功能：** 所有条件都必须满足

#### 语法
```javascript
condition1 && condition2 && condition3
```

#### 范例
```javascript
// 5字母且以"s"开头且以"e"结尾
{
  name: "特定模式",
  code: "word.length === 5 && \\-b[s] && \\-e[e]"
}

// 结果：snake, smile, stone 等
```

### 2. || 操作符（或逻辑）
**功能：** 任意一个条件满足即可

#### 语法
```javascript
condition1 || condition2 || condition3
```

#### 范例
```javascript
// 以"ing"或"ed"结尾
{
  name: "动词形式",
  code: "\\-e[ing] || \\-e[ed]"
}

// 结果：running, walked, singing, played 等
```

### 3. 非模式（v2.0.0 新语法）
**功能：** 满足前面条件但不满足后面条件

#### 新语法符号：`!`（逻辑非）
根据运算符重构方案，统一使用 `!` 符号表示逻辑非：
- 语义清晰（标准逻辑非符号）
- 与编程语言一致
- 易于理解和记忆

#### 语法格式
```javascript
condition1 ! condition2
// 等价于：condition1 && !(condition2)
```

#### 兼容性说明
- **v1.x版本**：使用 `--` 符号（已废弃）
- **v2.0.0+版本**：使用 `!` 符号（推荐）
- 提供自动转换工具进行迁移

#### 范例
```javascript
// 包含元音但不以元音开头（新语法）
{  
  name: "非元音开头但含元音",
  code: "\\m[aeiou] ! \\-b[aeiou]"
}

// 旧语法（v1.x，已废弃）
{
  name: "非元音开头但含元音（旧）",
  code: "\\m[aeiou] -- \\-b[aeiou]"
}

// 结果：cat, dog, but (排除 apple, orange)
```

## 全局集合定义

### 当前支持的集合
1. **元音集合：** `V = [aeiou]`
2. **辅音集合：** `C = [bcdfghjklmnpqrstvwxyz]`
3. **数字集合：** `N = [0-9]`
4. **字母集合：** `L = [a-zA-Z]`

### 使用方式
```javascript
// 使用全局集合
{
  name: "CVC模式",
  code: "\\-b[C] && \\m[V] && \\-e[C]"
}
```

### 建议扩展集合
```javascript
// 建议新增的全局集合
const GLOBAL_SETS = {
  V: '[aeiou]',           // 元音
  C: '[bcdfg...]',       // 辅音
  N: '[0-9]',           // 数字
  L: '[a-zA-Z]',        // 字母
  S: '[bcdfghjklmnpqrstvwxyz]', // 强辅音
  W: '[lrwy]',          // 弱辅音
  F: '[fvthsz]'         // 摩擦音
};
```

## 高级匹配模式

### 1. 音节模式匹配
```javascript
// CV模式（辅音+元音）
{
  name: "CV模式",
  code: "word.match(/^[bcdfg...][aeiou]/)"
}

// CVC模式（辅音+元音+辅音）
{
  name: "CVC模式",
  code: "word.match(/^[bcdfg...][aeiou][bcdfg...]$/)"
}
```

### 2. 重复模式匹配
```javascript
// 双字母
{
  name: "双字母",
  code: "word.match(/(.)\\1/)"
}

// 三重字母
{
  name: "三重字母",
  code: "word.match(/(.)\\1\\1/)"
}
```

### 3. 复杂组合模式
```javascript
// 长度5-7，包含双元音，不以s结尾（新语法）
{
  name: "复杂模式",
  code: "(word.length >= 5 && word.length <= 7) && word.match(/[aeiou]{2}/) ! \\-e[s]"
}

// 旧语法示例（v1.x）
{
  name: "复杂模式（旧）",
  code: "(word.length >= 5 && word.length <= 7) && word.match(/[aeiou]{2}/) -- \\-e[s]"
}
```

## 语法更新说明（v2.0.0）

### 运算符重构
根据项目的运算符重构方案，规则语法将在v2.0.0版本进行重大更新：

#### 主要变更
1. **具体规则标识**：`!` → `:` 
   ```javascript
   // 旧语法：!word.length >= 4
   // 新语法：:word.length >= 4
   ```

2. **逻辑非运算**：`--` → `!`
   ```javascript
   // 旧语法：condition1 -- condition2
   // 新语法：condition1 ! condition2
   ```

3. **字面字符**：`[text]` → `"text"`
   ```javascript
   // 旧语法：word.includes([tion])
   // 新语法：word.includes("tion")
   ```

#### 迁移支持
- 提供自动转换工具
- 兼容性层支持旧语法
- 渐进式迁移策略
- 完整的迁移文档

#### 迁移时间表
- **v1.2.0-v1.4.0**：新旧语法并存
- **v2.0.0**：正式启用新语法
- **v2.1.0+**：逐步移除旧语法支持

## 当前局限性分析

### 1. 音标匹配缺失
**问题：** 无法基于音标进行匹配
**影响：** 无法处理发音相关的筛选需求
**建议：** 集成音标数据库，支持音标匹配

### 2. 语义匹配缺失
**问题：** 无法基于词义进行筛选
**影响：** 无法按主题或语义分类
**建议：** 集成词典API或语义标签

### 3. 词性匹配缺失
**问题：** 无法按词性（名词、动词等）筛选
**影响：** 无法满足语法学习需求
**建议：** 集成词性标注功能

### 4. 复杂正则表达式支持有限
**问题：** 当前规则语法相对简单
**影响：** 无法表达复杂的匹配模式
**建议：** 扩展规则语法，支持更多正则特性

## 优化建议

### 1. 性能优化
```javascript
// 建议使用预编译正则表达式
class RuleEngine {
  constructor() {
    this.compiledRules = new Map();
  }
  
  compileRule(ruleCode) {
    if (!this.compiledRules.has(ruleCode)) {
      const regex = this.parseRuleToRegex(ruleCode);
      this.compiledRules.set(ruleCode, regex);
    }
    return this.compiledRules.get(ruleCode);
  }
}
```

### 2. 规则验证
```javascript
// 建议添加规则语法验证
function validateRule(ruleCode) {
  try {
    // 检查语法正确性
    const ast = parseRule(ruleCode);
    return { valid: true, ast };
  } catch (error) {
    return { valid: false, error: error.message };
  }
}
```

### 3. 规则提示系统
```javascript
// 建议添加智能提示
function getRuleSuggestions(partialRule) {
  const suggestions = [
    'word.length >= ',
    '\\-b[',
    '\\-e[',
    '\\m[',
    '[aeiou]',
    '[bcdfg...]'
  ];
  return suggestions.filter(s => s.startsWith(partialRule));
}
```

## 测试用例建议

### 1. 基础功能测试
```javascript
const testCases = [
  {
    rule: "word.length === 3",
    input: ["cat", "dog", "elephant"],
    expected: ["cat", "dog"]
  },
  {
    rule: "\\-b[s]",
    input: ["snake", "cat", "sun"],
    expected: ["snake", "sun"]
  }
];
```

### 2. 边界情况测试
```javascript
const edgeCases = [
  {
    rule: "word.length === 0",
    input: ["", "a"],
    expected: [""]
  },
  {
    rule: "\\-b[]",
    input: ["test"],
    expected: [] // 空模式应该不匹配任何内容
  }
];
```

## 扩展规划

### v1.2.0 - UI/UE优化
1. 规则编辑器界面优化
2. 规则预览功能增强
3. 错误提示和语法高亮
4. 规则示例库扩展

### v1.3.0 - 功能扩展
1. 完善全局集合定义
2. 添加规则验证功能
3. 实现规则智能提示
4. 性能优化和缓存机制

### v1.4.0 - 高级功能
1. 集成音标匹配
2. 添加词性标注
3. 支持复杂正则表达式
4. 规则组合和模板功能

### v2.0.0 - 核心重构
1. **运算符重构**：实现新语法系统
2. **代码重构**：分层架构和组件化
3. **文档化**：完整的文档体系
4. **兼容性**：旧语法迁移支持

### v2.1.0+ - 高级特性
1. 语义匹配功能
2. 机器学习辅助规则生成
3. 多语言支持
4. 云端规则库和同步

## 总结

当前的匹配规则系统已经具备了基础的字符匹配、位置匹配和组合逻辑功能，能够满足大部分单词筛选需求。

### 当前状态（v1.1.0）
- ✅ 基础字符集合匹配
- ✅ 位置匹配（词首、词中、词尾）
- ✅ 长度限制规则
- ✅ 基本组合逻辑（&&、||）
- ⚠️ 非模式操作符（使用临时语法`--`）

### 即将改进（v2.0.0）
1. **语法现代化**：统一运算符语义
2. **架构优化**：分层设计和组件化
3. **用户体验**：智能提示和错误处理
4. **性能提升**：编译优化和缓存机制
5. **文档完善**：自动生成和实时更新

### 发展方向
- **短期**：完善基础功能，优化用户体验
- **中期**：扩展高级特性，提升匹配能力
- **长期**：智能化和云端化，支持多语言

建议按照版本规划逐步实施改进，确保每个版本都有明确的价值交付和稳定的用户体验。

---

## 📚 相关文档
- [技术方案整合.md](./技术方案整合.md) - 完整的技术重构方案
- [v1.2.0开发规划.md](./v1.2.0开发规划.md) - 版本开发计划
- [需求与规划整合.md](./需求与规划整合.md) - 需求分析和优先级

---

*本文档与项目技术方案保持同步，最后更新：v1.1.0*