# 高级规则引擎系统测试用例

## 测试概述

本文档提供高级规则引擎系统的完整测试用例，采用黑盒测试方法，覆盖所有核心功能模块。

## 1. 集合定义与引用测试

### 1.1 基础集合定义测试

**测试入口：** 规则解析器 - 集合定义功能

#### 测试用例 1.1.1：单字母集合定义
**测试方案：**
```
输入：V = {a, e, i, o, u}
```
**预期结果：**
- 集合V成功定义
- 包含5个元素：a, e, i, o, u
- 可被后续规则引用

#### 测试用例 1.1.2：多字母集合定义
**测试方案：**
```
输入：BL = {bl, br, cl, cr, dr, fl, fr, gl, gr, pl, pr, sl, tr}
```
**预期结果：**
- 集合BL成功定义
- 包含13个多字母元素
- 元素正确存储和索引

#### 测试用例 1.1.3：混合长度集合定义
**测试方案：**
```
输入：MIX = {a, th, str, tion}
```
**预期结果：**
- 集合MIX成功定义
- 包含不同长度的元素
- 匹配时按最长优先原则

### 1.2 集合引用测试

#### 测试用例 1.2.1：正确集合引用
**测试方案：**
```
定义：V = {a, e, i, o, u}
引用：@V
```
**预期结果：**
- 引用解析成功
- 返回集合V的所有元素
- 可用于模式匹配

#### 测试用例 1.2.2：未定义集合引用
**测试方案：**
```
引用：@UNDEFINED
```
**预期结果：**
- 抛出"集合未定义"错误
- 错误信息包含集合名称
- 规则解析失败

#### 测试用例 1.2.3：循环引用检测
**测试方案：**
```
定义：A = {b, @B}
定义：B = {c, @A}
```
**预期结果：**
- 检测到循环引用
- 抛出"循环引用"错误
- 提供引用链信息

### 1.3 边界测试

#### 测试用例 1.3.1：空集合定义
**测试方案：**
```
输入：EMPTY = {}
```
**预期结果：**
- 抛出"空集合"错误
- 不允许定义空集合

#### 测试用例 1.3.2：重复集合名称
**测试方案：**
```
输入：V = {a, e, i}
输入：V = {o, u}
```
**预期结果：**
- 抛出"集合名称冲突"错误
- 保持第一次定义

#### 测试用例 1.3.3：超长集合名称
**测试方案：**
```
输入：VERYLONGCOLLECTIONNAME = {a}
```
**预期结果：**
- 根据系统限制处理
- 可能截断或报错

## 2. 集合运算测试

### 2.1 集合加法测试

#### 测试用例 2.1.1：基础集合加法
**测试方案：**
```
定义：V = {a, e, i}
定义：C = {b, c, d}
运算：V + C
```
**预期结果：**
- 返回合并集合：{a, e, i, b, c, d}
- 保持元素顺序
- 无重复元素

#### 测试用例 2.1.2：重复元素处理
**测试方案：**
```
定义：A = {a, b, c}
定义：B = {b, c, d}
运算：A + B
```
**预期结果：**
- 返回去重集合：{a, b, c, d}
- 保留首次出现位置

#### 测试用例 2.1.3：字面值加法
**测试方案：**
```
定义：V = {a, e, i}
运算：V + o + u
```
**预期结果：**
- 返回扩展集合：{a, e, i, o, u}
- 字面值正确添加

### 2.2 集合减法测试

#### 测试用例 2.2.1：基础集合减法
**测试方案：**
```
定义：ALL = {a, b, c, d, e}
定义：VOWEL = {a, e}
运算：ALL - VOWEL
```
**预期结果：**
- 返回差集：{b, c, d}
- 正确移除指定元素

#### 测试用例 2.2.2：字面值减法
**测试方案：**
```
定义：LETTERS = {a, b, c, d}
运算：LETTERS - a - c
```
**预期结果：**
- 返回结果：{b, d}
- 字面值正确移除

#### 测试用例 2.2.3：减法结果为空
**测试方案：**
```
定义：A = {a, b}
运算：A - a - b
```
**预期结果：**
- 返回空集合或报错
- 根据系统设计处理

### 2.3 破坏性测试

#### 测试用例 2.3.1：无效运算符
**测试方案：**
```
输入：A * B
```
**预期结果：**
- 抛出"无效运算符"错误
- 提供支持的运算符列表

#### 测试用例 2.3.2：运算符优先级错误
**测试方案：**
```
输入：A + B - C + D
```
**预期结果：**
- 按左到右顺序计算
- 或根据优先级规则计算

## 3. 组合规则测试

### 3.1 逻辑运算符测试

#### 测试用例 3.1.1：AND运算符测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
定义：C = {b, c, d, f, g}
规则：@V && @C
测试词："bad", "cat", "xyz"
```
**预期结果：**
- "bad"：匹配（包含a和d）
- "cat"：匹配（包含a和c）
- "xyz"：不匹配（无元音）

#### 测试用例 3.1.2：OR运算符测试
**测试方案：**
```
定义：START = {b, c, d}
定义：END = {x, y, z}
规则：@START || @END
测试词："apple", "box", "lazy"
```
**预期结果：**
- "apple"：不匹配
- "box"：匹配（以b开头）
- "lazy"：匹配（以z结尾）

#### 测试用例 3.1.3：NOT运算符测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
规则：!@V
测试词："bcdfg", "hello"
```
**预期结果：**
- "bcdfg"：匹配（无元音）
- "hello"：不匹配（包含元音）

#### 测试用例 3.1.4：XOR运算符测试
**测试方案：**
```
定义：A = {a, b}
定义：B = {b, c}
规则：@A ~ @B
测试词："ab", "bc", "abc"
```
**预期结果：**
- "ab"：匹配（只满足A）
- "bc"：匹配（只满足B）
- "abc"：不匹配（同时满足A和B）

### 3.2 运算优先级测试

#### 测试用例 3.2.1：优先级组合测试
**测试方案：**
```
规则：@A && @B || @C
等价于：(@A && @B) || @C
```
**预期结果：**
- 按正确优先级计算
- AND优先于OR

#### 测试用例 3.2.2：括号优先级测试
**测试方案：**
```
规则：@A && (@B || @C)
```
**预期结果：**
- 括号内优先计算
- 结果符合预期逻辑

### 3.3 边界测试

#### 测试用例 3.3.1：嵌套层级限制
**测试方案：**
```
规则：((((@A && @B) || @C) && @D) || @E)
```
**预期结果：**
- 根据系统限制处理
- 可能限制嵌套深度

#### 测试用例 3.3.2：空规则测试
**测试方案：**
```
规则：()
```
**预期结果：**
- 抛出"空规则"错误
- 提供语法帮助

## 4. 位置标记系统测试

### 4.1 位置标记定义测试

#### 测试用例 4.1.1：前缀标记测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
规则：@V^word
测试词："apple", "orange", "banana"
```
**预期结果：**
- "apple"：匹配（以a开头）
- "orange"：匹配（以o开头）
- "banana"：不匹配（以b开头）

#### 测试用例 4.1.2：后缀标记测试
**测试方案：**
```
定义：END = {s, d, t}
规则：word@END$
测试词："cats", "played", "run"
```
**预期结果：**
- "cats"：匹配（以s结尾）
- "played"：匹配（以d结尾）
- "run"：不匹配（以n结尾）

#### 测试用例 4.1.3：中间位置标记测试
**测试方案：**
```
定义：MID = {ll, ss, tt}
规则：word@MID~word
测试词："hello", "class", "better"
```
**预期结果：**
- "hello"：匹配（中间有ll）
- "class"：匹配（中间有ss）
- "better"：匹配（中间有tt）

### 4.2 位置组合测试

#### 测试用例 4.2.1：多位置标记
**测试方案：**
```
规则：@V^word@C$
测试词："at", "it", "up"
```
**预期结果：**
- "at"：匹配（元音开头，辅音结尾）
- "it"：匹配（元音开头，辅音结尾）
- "up"：匹配（元音开头，辅音结尾）

### 4.3 破坏性测试

#### 测试用例 4.3.1：无效位置标记
**测试方案：**
```
规则：@V#word
```
**预期结果：**
- 抛出"无效位置标记"错误
- 提供有效标记列表

#### 测试用例 4.3.2：冲突位置标记
**测试方案：**
```
规则：@V^$word
```
**预期结果：**
- 抛出"位置标记冲突"错误
- 说明冲突原因

## 5. 模式元素类型测试

### 5.1 集合量词测试

#### 测试用例 5.1.1：单个匹配测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
规则：@V{1}
测试词："a", "ae", "aei"
```
**预期结果：**
- "a"：匹配（1个元音）
- "ae"：不匹配（2个元音）
- "aei"：不匹配（3个元音）

#### 测试用例 5.1.2：范围匹配测试
**测试方案：**
```
定义：C = {b, c, d, f, g}
规则：@C{2,4}
测试词："bc", "bcd", "bcdf", "bcdfg"
```
**预期结果：**
- "bc"：匹配（2个辅音）
- "bcd"：匹配（3个辅音）
- "bcdf"：匹配（4个辅音）
- "bcdfg"：不匹配（5个辅音）

#### 测试用例 5.1.3：无限匹配测试
**测试方案：**
```
规则：@V{2,}
测试词："ae", "aei", "aeiou"
```
**预期结果：**
- "ae"：匹配（2个元音）
- "aei"：匹配（3个元音）
- "aeiou"：匹配（5个元音）

### 5.2 字面字符测试

#### 测试用例 5.2.1：单字符匹配
**测试方案：**
```
规则：a
测试词："apple", "banana", "orange"
```
**预期结果：**
- "apple"：匹配（包含a）
- "banana"：匹配（包含a）
- "orange"：不匹配（不包含a）

#### 测试用例 5.2.2：多字符匹配
**测试方案：**
```
规则：th
测试词："the", "think", "cat"
```
**预期结果：**
- "the"：匹配（包含th）
- "think"：匹配（包含th）
- "cat"：不匹配（不包含th）

### 5.3 混合模式测试

#### 测试用例 5.3.1：集合与字面字符组合
**测试方案：**
```
定义：V = {a, e, i, o, u}
规则：@V + th
测试词："earth", "think", "cat"
```
**预期结果：**
- "earth"：匹配（包含元音和th）
- "think"：匹配（包含元音和th）
- "cat"：不匹配（无th）

## 6. 逻辑运算系统测试

### 6.1 表达式解析测试

#### 测试用例 6.1.1：复杂表达式解析
**测试方案：**
```
规则：(@A && @B) || (!@C && @D)
```
**预期结果：**
- 正确解析表达式结构
- 识别所有运算符和操作数
- 构建正确的语法树

#### 测试用例 6.1.2：嵌套括号解析
**测试方案：**
```
规则：((@A || @B) && (@C || @D))
```
**预期结果：**
- 正确处理嵌套括号
- 按正确顺序计算

### 6.2 运算求值测试

#### 测试用例 6.2.1：短路求值测试
**测试方案：**
```
规则：false && @UNDEFINED
```
**预期结果：**
- 短路求值，不计算@UNDEFINED
- 返回false结果

#### 测试用例 6.2.2：完整求值测试
**测试方案：**
```
规则：true || @UNDEFINED
```
**预期结果：**
- 短路求值，不计算@UNDEFINED
- 返回true结果

### 6.3 错误处理测试

#### 测试用例 6.3.1：语法错误测试
**测试方案：**
```
规则：@A &&& @B
```
**预期结果：**
- 抛出"语法错误"异常
- 指出错误位置

#### 测试用例 6.3.2：括号不匹配测试
**测试方案：**
```
规则：(@A && @B
```
**预期结果：**
- 抛出"括号不匹配"错误
- 提供修复建议

## 7. 排序策略引擎测试

### 7.1 基础排序测试

#### 测试用例 7.1.1：单级排序测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
排序规则：@V
测试词：["apple", "orange", "banana", "grape"]
```
**预期结果：**
- 按元音字母排序
- "apple"(a), "orange"(o), "banana"(a), "grape"(a)
- 相同元音按原顺序

#### 测试用例 7.1.2：位置匹配排序测试
**测试方案：**
```
定义：C = {b, c, d, f, g}
排序规则：@C^
测试词：["cat", "dog", "fish", "apple"]
```
**预期结果：**
- 按首字母辅音排序
- "cat"(c), "dog"(d), "fish"(f), "apple"(无匹配)

### 7.2 多级排序测试

#### 测试用例 7.2.1：二级排序测试
**测试方案：**
```
定义：V = {a, e, i, o, u}
定义：C = {b, c, d, f, g}
排序规则：@V^, @C$
测试词：["cat", "cot", "bat", "bot"]
```
**预期结果：**
- 第一级：按首元音排序
- 第二级：按末辅音排序
- 正确的多级分组

#### 测试用例 7.2.2：三级排序测试
**测试方案：**
```
排序规则：@V^, @C~, @END$
```
**预期结果：**
- 三级排序正确执行
- 分组标签正确生成

### 7.3 排序边界测试

#### 测试用例 7.3.1：无匹配元素排序
**测试方案：**
```
定义：NUM = {1, 2, 3}
排序规则：@NUM
测试词：["cat", "dog"]
```
**预期结果：**
- 所有词归入"其他"分组
- 保持原始顺序

#### 测试用例 7.3.2：部分匹配排序
**测试方案：**
```
排序规则：@V^, @C$
测试词：["apple", "xyz"]
```
**预期结果：**
- "apple"：完全匹配
- "xyz"：部分匹配或无匹配
- 正确处理不同匹配情况

## 8. 分组标签生成测试

### 8.1 标签格式测试

#### 测试用例 8.1.1：单级标签测试
**测试方案：**
```
排序规则：@V
匹配结果：元音a
```
**预期结果：**
- 生成标签："a"
- 格式正确

#### 测试用例 8.1.2：二级标签测试
**测试方案：**
```
排序规则：@V^, @C$
匹配结果：元音a, 辅音t
```
**预期结果：**
- 生成标签："a - t"
- 分隔符正确

#### 测试用例 8.1.3：三级标签测试
**测试方案：**
```
排序规则：@V^, @C~, @END$
匹配结果：元音a, 辅音p, 结尾e
```
**预期结果：**
- 生成标签："a - p - e"
- 三级格式正确

### 8.2 标签排序测试

#### 测试用例 8.2.1：字母顺序排序
**测试方案：**
```
标签：["c", "a", "b"]
```
**预期结果：**
- 排序后：["a", "b", "c"]
- 字母顺序正确

#### 测试用例 8.2.2：多级标签排序
**测试方案：**
```
标签：["a - t", "a - b", "b - c"]
```
**预期结果：**
- 排序后：["a - b", "a - t", "b - c"]
- 多级排序正确

### 8.3 特殊情况测试

#### 测试用例 8.3.1：空匹配标签
**测试方案：**
```
匹配结果：无匹配
```
**预期结果：**
- 生成默认标签："其他"
- 或系统定义的默认值

#### 测试用例 8.3.2：重复标签处理
**测试方案：**
```
多个词生成相同标签
```
**预期结果：**
- 标签不重复
- 词汇正确归组

## 9. 完整规则示例测试

### 9.1 基础规则测试

#### 测试用例 9.1.1：元音筛选规则
**测试方案：**
```
规则：
V = {a, e, i, o, u}
@V

测试词：["apple", "orange", "xyz", "rhythm"]
```
**预期结果：**
- "apple"：匹配（包含a, e）
- "orange"：匹配（包含o, a, e）
- "xyz"：不匹配（无元音）
- "rhythm"：不匹配（无标准元音）

### 9.2 集合运算规则测试

#### 测试用例 9.2.1：复合集合规则
**测试方案：**
```
规则：
V = {a, e, i, o, u}
C = {b, c, d, f, g, h, j, k, l, m, n, p, q, r, s, t, v, w, x, y, z}
VC = V + C
@VC

测试词：["hello", "123", "café"]
```
**预期结果：**
- "hello"：匹配（全为字母）
- "123"：不匹配（全为数字）
- "café"：部分匹配（包含字母）

### 9.3 组合规则测试

#### 测试用例 9.3.1：复杂逻辑规则
**测试方案：**
```
规则：
V = {a, e, i, o, u}
START = {b, c, d}
END = {s, t, d}
(@V && @START^) || @END$

测试词：["cat", "dog", "apple", "test"]
```
**预期结果：**
- "cat"：匹配（包含元音且以c开头）
- "dog"：匹配（包含元音且以d开头）
- "apple"：不匹配（不以指定字母开头）
- "test"：匹配（以t结尾）

### 9.4 多级排序规则测试

#### 测试用例 9.4.1：完整排序规则
**测试方案：**
```
规则：
V = {a, e, i, o, u}
C = {b, c, d, f, g}
END = {s, t, d}

筛选：@V
排序：@V^, @C~, @END$

测试词：["cats", "dogs", "apple", "orange", "test"]
```
**预期结果：**
- 筛选：保留包含元音的词
- 排序：按首元音、中间辅音、结尾字母三级排序
- 分组标签正确生成

## 10. 常见错误与使用建议测试

### 10.1 语法错误测试

#### 测试用例 10.1.1：集合引用错误
**测试方案：**
```
错误输入：V
正确输入：@V
```
**预期结果：**
- 错误：抛出"缺少@符号"错误
- 正确：成功引用集合

#### 测试用例 10.1.2：多字母集合引用错误
**测试方案：**
```
错误输入：@BL
正确输入：@(BL)
```
**预期结果：**
- 错误：可能解析为@B和L
- 正确：正确引用BL集合

### 10.2 性能测试

#### 测试用例 10.2.1：大数据集测试
**测试方案：**
```
测试数据：10000个单词
复杂规则：多级排序 + 复杂逻辑
```
**预期结果：**
- 处理时间在可接受范围内
- 内存使用合理
- 结果正确性保持

#### 测试用例 10.2.2：复杂规则性能测试
**测试方案：**
```
规则：深度嵌套的逻辑表达式
测试：响应时间和资源消耗
```
**预期结果：**
- 性能在可接受范围内
- 无内存泄漏
- 结果准确

## 11. 破坏性测试

### 11.1 恶意输入测试

#### 测试用例 11.1.1：SQL注入式输入
**测试方案：**
```
输入：'; DROP TABLE rules; --
```
**预期结果：**
- 输入被安全处理
- 不影响系统稳定性
- 返回适当错误信息

#### 测试用例 11.1.2：超长输入测试
**测试方案：**
```
输入：极长的规则字符串（>10MB）
```
**预期结果：**
- 系统优雅处理
- 可能截断或拒绝
- 不导致崩溃

### 11.2 资源耗尽测试

#### 测试用例 11.2.1：内存耗尽测试
**测试方案：**
```
创建大量大型集合定义
```
**预期结果：**
- 系统监控内存使用
- 达到限制时优雅降级
- 提供适当错误信息

#### 测试用例 11.2.2：递归深度测试
**测试方案：**
```
创建极深的嵌套规则
```
**预期结果：**
- 检测递归深度
- 防止栈溢出
- 返回深度限制错误

## 12. 集成测试

### 12.1 端到端测试

#### 测试用例 12.1.1：完整工作流测试
**测试方案：**
```
1. 定义集合
2. 创建筛选规则
3. 设置排序规则
4. 处理测试数据
5. 验证输出结果
```
**预期结果：**
- 整个流程无错误
- 输出结果正确
- 性能满足要求

### 12.2 兼容性测试

#### 测试用例 12.2.1：向后兼容性测试
**测试方案：**
```
使用旧版本规则语法
```
**预期结果：**
- 旧规则正常工作
- 新功能可选使用
- 无破坏性变更

## 测试执行指南

### 测试环境要求
- 独立的测试环境
- 标准测试数据集
- 性能监控工具
- 错误日志记录

### 测试执行顺序
1. 单元测试（各模块独立测试）
2. 集成测试（模块间交互测试）
3. 系统测试（完整功能测试）
4. 性能测试（负载和压力测试）
5. 安全测试（破坏性测试）

### 测试结果评估
- 功能正确性：100%通过
- 性能要求：响应时间<1秒
- 稳定性：无崩溃和内存泄漏
- 安全性：恶意输入安全处理

### 缺陷管理
- 严重级别分类
- 修复优先级排序
- 回归测试要求
- 发布标准定义