# 数据持久化与同步系统测试用例

## 测试概述

本文档采用黑盒测试方法，对数据持久化与同步系统的各个功能模块进行全面测试，包括常规流程、边界测试和破坏性测试。

## 1. localStorage 存储模块

### 1.1 规则数据存储测试

**测试入口：** 规则保存功能

#### 测试用例 1.1.1：标准规则数据存储
**测试方案：**
```json
{
  "测试规则": {
    "name": "测试规则",
    "comment": "这是一个测试规则",
    "localSets": [["元音", ["a", "e", "i"]]],
    "specificRule": "V",
    "displayRule": "@V"
  }
}
```
**预期结果：**
- 数据成功保存到 localStorage
- 键名为 "wordFilterRules"
- 数据结构完整无损

#### 测试用例 1.1.2：复杂规则数据存储
**测试方案：**
```json
{
  "复杂规则": {
    "name": "复杂规则",
    "comment": "包含多个本地集合的规则",
    "localSets": [
      ["元音", ["a", "e", "i", "o", "u"]],
      ["辅音", ["b", "c", "d", "f", "g"]]
    ],
    "specificRule": "V & C$",
    "displayRule": "@V & @C$"
  }
}
```
**预期结果：**
- 多个本地集合正确保存
- 复杂规则语法完整保存
- 数据读取时结构正确恢复

#### 测试用例 1.1.3：规则数据更新
**测试方案：**
1. 保存初始规则数据
2. 修改规则内容
3. 再次保存
**预期结果：**
- 旧数据被正确覆盖
- 新数据完整保存
- 无数据残留或冲突

### 1.2 全局集合存储测试

#### 测试用例 1.2.1：基础全局集合存储
**测试方案：**
```json
{
  "自定义元音": ["a", "e", "i", "o", "u"],
  "自定义辅音": ["b", "c", "d", "f"]
}
```
**预期结果：**
- 全局集合正确保存到 localStorage
- 键名为 "globalSets"
- 集合数据可被规则引用

#### 测试用例 1.2.2：大型集合存储
**测试方案：**
```json
{
  "大型集合": ["item1", "item2", ..., "item1000"]
}
```
**预期结果：**
- 大型集合完整保存
- 读取性能在可接受范围
- 无数据截断或丢失

#### 测试用例 1.2.3：特殊字符集合存储
**测试方案：**
```json
{
  "特殊字符": ["café", "naïve", "résumé", "piñata"]
}
```
**预期结果：**
- 特殊字符正确保存
- Unicode 字符无损存储
- 读取时字符显示正确

### 1.3 数据完整性验证测试

#### 测试用例 1.3.1：正常数据验证
**测试方案：** 保存标准格式的规则数据
**预期结果：**
- 数据验证通过
- 无错误提示
- 数据正常加载

#### 测试用例 1.3.2：损坏数据恢复
**测试方案：** 手动修改 localStorage 中的数据，破坏 JSON 格式
**预期结果：**
- 系统检测到数据损坏
- 使用默认数据或恢复机制
- 显示友好的错误提示

#### 测试用例 1.3.3：部分数据损坏处理
**测试方案：** 损坏部分规则数据，保留其他有效数据
**预期结果：**
- 有效数据正常加载
- 损坏数据被跳过或修复
- 用户收到部分数据丢失提示

## 2. 文件存储管理模块

### 2.1 文件导出测试

#### 测试用例 2.1.1：规则文件导出
**测试方案：** 导出包含多个规则的完整数据
**预期结果：**
- 生成标准 JSON 格式文件
- 包含 globalSets 和 rules 字段
- 文件内容完整无损

#### 测试用例 2.1.2：空数据导出
**测试方案：** 在无规则数据时执行导出
**预期结果：**
- 生成包含空结构的文件
- 文件格式正确
- 可正常导入使用

#### 测试用例 2.1.3：大数据量导出
**测试方案：** 导出包含1000+规则的大型数据集
**预期结果：**
- 导出操作成功完成
- 文件大小合理
- 导出时间在可接受范围

### 2.2 文件导入测试

#### 测试用例 2.2.1：标准格式文件导入
**测试方案：** 导入标准格式的规则文件
**预期结果：**
- 规则和集合正确导入
- 数据结构完整恢复
- 界面正确更新显示

#### 测试用例 2.2.2：数据合并导入
**测试方案：** 在已有数据基础上导入新文件
**预期结果：**
- 新数据正确合并
- 重名规则按策略处理
- 全局集合正确合并

#### 测试用例 2.2.3：冲突数据处理
**测试方案：** 导入包含同名规则的文件
**预期结果：**
- 显示冲突处理选项
- 用户选择后正确执行
- 最终数据状态正确

### 2.3 向后兼容性测试

#### 测试用例 2.3.1：旧格式文件导入
**测试方案：** 导入旧版本格式的规则文件（直接规则对象）
**预期结果：**
- 旧格式正确识别
- 自动转换为新格式
- 数据完整性保持

#### 测试用例 2.3.2：混合格式处理
**测试方案：** 导入部分符合新格式的文件
**预期结果：**
- 正确识别格式类型
- 适当的转换处理
- 数据正确加载

#### 测试用例 2.3.3：格式检测准确性
**测试方案：** 测试各种边界格式的文件
**预期结果：**
- 格式检测准确无误
- 无误判或漏判
- 错误格式正确拒绝

## 3. 数据序列化模块

### 3.1 复杂数据结构序列化测试

#### 测试用例 3.1.1：Map 数据序列化
**测试方案：** 序列化包含 Map 结构的规则数据
**预期结果：**
- Map 正确转换为数组格式
- 键值对关系保持
- 序列化数据可逆

#### 测试用例 3.1.2：Set 数据序列化
**测试方案：** 序列化包含 Set 结构的集合数据
**预期结果：**
- Set 正确转换为数组格式
- 元素唯一性保持
- 序列化数据可逆

#### 测试用例 3.1.3：嵌套结构序列化
**测试方案：** 序列化包含嵌套 Map/Set 的复杂数据
**预期结果：**
- 嵌套结构正确处理
- 层级关系保持
- 完整数据可恢复

### 3.2 数据反序列化测试

#### 测试用例 3.2.1：标准数组反序列化
**测试方案：** 反序列化标准的数组格式数据
**预期结果：**
- 数组正确恢复为 Map/Set
- 数据类型正确
- 功能完全恢复

#### 测试用例 3.2.2：异常数据反序列化
**测试方案：** 反序列化格式异常的数据
**预期结果：**
- 异常数据被正确处理
- 系统不崩溃
- 提供错误信息

#### 测试用例 3.2.3：性能测试
**测试方案：** 反序列化大量数据
**预期结果：**
- 处理时间合理
- 内存使用正常
- 用户体验良好

## 4. 跨页面同步模块

### 4.1 实时数据同步测试

#### 测试用例 4.1.1：基础同步功能
**测试方案：**
1. 在页面A修改规则
2. 切换到页面B
3. 检查数据同步状态
**预期结果：**
- 页面B显示页面A的修改
- 同步延迟最小
- 数据完整一致

#### 测试用例 4.1.2：多页面同步
**测试方案：**
1. 同时打开3个页面
2. 在任一页面修改数据
3. 检查其他页面同步情况
**预期结果：**
- 所有页面数据一致
- 同步机制稳定
- 无数据丢失

#### 测试用例 4.1.3：频繁修改同步
**测试方案：** 短时间内进行多次数据修改
**预期结果：**
- 所有修改正确同步
- 无数据覆盖丢失
- 最终状态正确

### 4.2 冲突处理测试

#### 测试用例 4.2.1：同时修改冲突
**测试方案：**
1. 在两个页面同时修改同一规则
2. 观察冲突处理结果
**预期结果：**
- 按时间戳优先策略处理
- 后修改的数据生效
- 用户收到冲突提示

#### 测试用例 4.2.2：网络中断恢复
**测试方案：**
1. 模拟网络中断
2. 在离线状态修改数据
3. 恢复网络连接
**预期结果：**
- 离线修改正确保存
- 网络恢复后正确同步
- 数据完整性保持

#### 测试用例 4.2.3：版本冲突处理
**测试方案：** 模拟不同版本数据的冲突
**预期结果：**
- 版本差异正确识别
- 合并策略正确执行
- 用户可选择处理方式

## 5. 性能测试模块

### 5.1 存储性能测试

#### 测试用例 5.1.1：大数据量存储性能
**测试方案：** 存储包含1000个规则的数据集
**性能指标：**
- 存储时间 < 2秒
- 内存使用 < 50MB
- CPU 使用率 < 80%
**验证方法：** 使用浏览器性能工具监测

#### 测试用例 5.1.2：频繁读写性能
**测试方案：** 连续进行100次读写操作
**性能指标：**
- 平均响应时间 < 100ms
- 操作成功率 = 100%
- 无内存泄漏
**验证方法：** 统计操作时间和成功率

#### 测试用例 5.1.3：并发操作性能
**测试方案：** 模拟多个页面同时进行数据操作
**性能指标：**
- 并发处理正确
- 数据一致性保持
- 性能无显著下降
**验证方法：** 多页面并发测试

### 5.2 内存管理测试

#### 测试用例 5.2.1：内存使用监控
**测试方案：** 长时间运行应用，监控内存使用
**预期结果：**
- 内存使用稳定
- 无明显内存泄漏
- 垃圾回收正常

#### 测试用例 5.2.2：大数据集内存优化
**测试方案：** 加载超大规则集，测试内存优化
**预期结果：**
- 内存使用合理
- 加载时间可接受
- 应用响应正常

#### 测试用例 5.2.3：内存清理机制
**测试方案：** 测试数据清理和内存释放
**预期结果：**
- 清理操作有效
- 内存正确释放
- 性能恢复正常

## 6. 错误处理模块

### 6.1 存储错误处理测试

#### 测试用例 6.1.1：存储空间不足处理
**测试方案：** 模拟 localStorage 容量限制
**预期结果：**
- 检测到存储限制
- 提示用户清理数据
- 提供解决方案

#### 测试用例 6.1.2：存储权限错误处理
**测试方案：** 模拟存储权限被拒绝
**预期结果：**
- 错误被正确捕获
- 显示明确错误信息
- 提供替代方案

#### 测试用例 6.1.3：数据损坏恢复
**测试方案：** 模拟存储数据损坏
**预期结果：**
- 损坏数据被检测
- 自动恢复机制启动
- 用户数据尽可能保留

### 6.2 文件操作错误处理测试

#### 测试用例 6.2.1：文件读取失败处理
**测试方案：** 尝试读取损坏或无效文件
**预期结果：**
- 文件错误被捕获
- 显示具体错误信息
- 不影响应用稳定性

#### 测试用例 6.2.2：文件保存失败处理
**测试方案：** 模拟磁盘空间不足或权限不足
**预期结果：**
- 保存错误被处理
- 提示用户具体原因
- 提供解决建议

#### 测试用例 6.2.3：网络错误处理
**测试方案：** 模拟网络中断或超时
**预期结果：**
- 网络错误被识别
- 提供重试机制
- 离线模式正常工作

## 7. 安全性测试模块

### 7.1 数据安全测试

#### 测试用例 7.1.1：数据注入防护
**测试方案：** 输入包含恶意脚本的数据
**预期结果：**
- 恶意代码被过滤
- 数据安全存储
- 无安全漏洞

#### 测试用例 7.1.2：XSS 防护测试
**测试方案：** 尝试注入 XSS 攻击代码
**预期结果：**
- XSS 攻击被阻止
- 数据正确转义
- 应用安全运行

#### 测试用例 7.1.3：数据完整性校验
**测试方案：** 手动修改存储数据，测试校验机制
**预期结果：**
- 数据篡改被检测
- 完整性校验生效
- 异常数据被处理

### 7.2 隐私保护测试

#### 测试用例 7.2.1：本地数据隔离
**测试方案：** 验证不同域名下的数据隔离
**预期结果：**
- 数据完全隔离
- 无跨域数据泄露
- 隐私保护有效

#### 测试用例 7.2.2：敏感信息处理
**测试方案：** 测试敏感数据的处理方式
**预期结果：**
- 敏感信息不被记录
- 日志信息安全
- 隐私数据保护

#### 测试用例 7.2.3：数据清理验证
**测试方案：** 验证数据删除的彻底性
**预期结果：**
- 删除数据无法恢复
- 清理操作彻底
- 无数据残留

## 8. 兼容性测试模块

### 8.1 浏览器兼容性测试

#### 测试用例 8.1.1：主流浏览器测试
**测试范围：** Chrome, Firefox, Safari, Edge
**预期结果：**
- 所有功能正常工作
- 性能表现一致
- 用户体验统一

#### 测试用例 8.1.2：移动浏览器测试
**测试范围：** 移动版 Chrome, Safari, Firefox
**预期结果：**
- 移动端功能完整
- 触摸操作正常
- 响应式设计有效

#### 测试用例 8.1.3：旧版本浏览器测试
**测试范围：** 较旧版本的主流浏览器
**预期结果：**
- 基础功能可用
- 降级方案生效
- 用户体验可接受

### 8.2 API 兼容性测试

#### 测试用例 8.2.1：File System Access API 测试
**测试方案：** 在支持和不支持的浏览器中测试
**预期结果：**
- 支持时使用现代 API
- 不支持时降级处理
- 功能完整性保持

#### 测试用例 8.2.2：localStorage API 测试
**测试方案：** 测试 localStorage 的各种使用场景
**预期结果：**
- API 调用正确
- 异常情况处理
- 兼容性良好

#### 测试用例 8.2.3：现代 JavaScript 特性测试
**测试方案：** 测试 ES6+ 特性的兼容性
**预期结果：**
- 现代特性正常工作
- 旧浏览器有降级
- 代码执行稳定