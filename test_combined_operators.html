<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»„åˆè¿ç®—ç¬¦éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .test-rule {
            font-family: 'Courier New', monospace;
            background-color: #ecf0f1;
            padding: 8px;
            border-radius: 3px;
            margin: 5px 0;
            border-left: 4px solid #3498db;
        }
        .test-explanation {
            color: #7f8c8d;
            font-style: italic;
            margin: 5px 0;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d5f4e6;
            border-left: 4px solid #27ae60;
            color: #27ae60;
        }
        .error {
            background-color: #fdf2f2;
            border-left: 4px solid #e74c3c;
            color: #e74c3c;
        }
        .warning {
            background-color: #fef9e7;
            border-left: 4px solid #f39c12;
            color: #f39c12;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 5px;
            border-left: 4px solid #34495e;
        }
        .operator-info {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .priority-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .priority-table th, .priority-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .priority-table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç»„åˆè¿ç®—ç¬¦éªŒè¯æµ‹è¯•</h1>
        
        <div class="operator-info">
            <h3>è¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§</h3>
            <table class="priority-table">
                <tr>
                    <th>è¿ç®—ç¬¦</th>
                    <th>ä¼˜å…ˆçº§</th>
                    <th>ç»“åˆæ€§</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>~</td>
                    <td>4ï¼ˆæœ€é«˜ï¼‰</td>
                    <td>å³ç»“åˆ</td>
                    <td>å–åè¿ç®—</td>
                </tr>
                <tr>
                    <td>!</td>
                    <td>3</td>
                    <td>å·¦ç»“åˆ</td>
                    <td>å·®é›†è¿ç®—</td>
                </tr>
                <tr>
                    <td>&&</td>
                    <td>2</td>
                    <td>å·¦ç»“åˆ</td>
                    <td>ä¸è¿ç®—</td>
                </tr>
                <tr>
                    <td>||</td>
                    <td>1ï¼ˆæœ€ä½ï¼‰</td>
                    <td>å·¦ç»“åˆ</td>
                    <td>æˆ–è¿ç®—</td>
                </tr>
            </table>
        </div>

        <div class="controls">
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <h2>1. åŸºç¡€è¿ç®—ç¬¦éªŒè¯</h2>
        <div id="basic-tests"></div>

        <h2>2. å¤šè§„åˆ™ç»„åˆéªŒè¯</h2>
        <div id="multi-rule-tests"></div>

        <h2>3. ç»“åˆå¾‹éªŒè¯</h2>
        <div id="associativity-tests"></div>

        <h2>4. ä¼˜å…ˆçº§éªŒè¯</h2>
        <div id="precedence-tests"></div>

        <h2>5. æ‹¬å·ä¼˜å…ˆçº§éªŒè¯</h2>
        <div id="parentheses-tests"></div>

        <div class="summary" id="test-summary" style="display: none;">
            <h3>æµ‹è¯•æ€»ç»“</h3>
            <div id="summary-content"></div>
        </div>
    </div>

    <script src="js/fileStorage.js"></script>
    <script src="js/ruleEngine.js"></script>
    <script>
        // ä½¿ç”¨ä¸»ç¨‹åºçš„RuleEngineè¿›è¡Œæµ‹è¯•
        class TestRuleEngine extends RuleEngine {
            constructor() {
                super(); // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
                this.initTestRules();
            }

            initTestRules() {
                // åˆ›å»ºæµ‹è¯•ç”¨çš„åŸºç¡€è§„åˆ™
                this.rules.set('A', { name: 'A', specificRule: 'a', displayRule: 'a' });
                this.rules.set('B', { name: 'B', specificRule: 'b', displayRule: 'b' });
                this.rules.set('C', { name: 'C', specificRule: 'c', displayRule: 'c' });
                this.rules.set('D', { name: 'D', specificRule: 'd', displayRule: 'd' });
                this.rules.set('E', { name: 'E', specificRule: 'e', displayRule: 'e' });
            }

            // æ¨¡æ‹Ÿç»„åˆè§„åˆ™éªŒè¯
            validateCombinedRule(ruleExpression) {
                try {
                    // ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•
                    this.validateCombinedRuleSyntax(ruleExpression);
                    const ast = this.parseLogicExpression(ruleExpression);
                    return { success: true, ast: ast };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            // æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•éƒ½ä½¿ç”¨çˆ¶ç±»RuleEngineçš„å®ç°

            // å°†ASTè½¬æ¢ä¸ºå¯è¯»çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²
            astToString(node) {
                if (node.type === 'rule') {
                    return node.value;
                } else if (node.type === 'negate') {
                    return `~(${this.astToString(node.operand)})`;
                } else if (node.type === 'not') {
                    return `(${this.astToString(node.left)} ! ${this.astToString(node.right)})`;
                } else if (node.type === 'and') {
                    return `(${this.astToString(node.left)} && ${this.astToString(node.right)})`;
                } else if (node.type === 'or') {
                    return `(${this.astToString(node.left)} || ${this.astToString(node.right)})`;
                }
                return 'unknown';
            }
        }

        const engine = new TestRuleEngine();

        // æµ‹è¯•ç”¨ä¾‹å®šä¹‰
        const testCases = {
            basic: [
                {
                    title: 'å–åè¿ç®—ç¬¦ ~',
                    rule: '~A',
                    explanation: 'å¯¹è§„åˆ™Açš„ç»“æœå–å',
                    expected: '~(A)'
                },
                {
                    title: 'å·®é›†è¿ç®—ç¬¦ !',
                    rule: 'A!B',
                    explanation: 'æ»¡è¶³Aä½†ä¸æ»¡è¶³Bçš„ç»“æœ',
                    expected: '(A ! B)'
                },
                {
                    title: 'ä¸è¿ç®—ç¬¦ &&',
                    rule: 'A&&B',
                    explanation: 'åŒæ—¶æ»¡è¶³Aå’ŒBçš„ç»“æœ',
                    expected: '(A && B)'
                },
                {
                    title: 'æˆ–è¿ç®—ç¬¦ ||',
                    rule: 'A||B',
                    explanation: 'æ»¡è¶³Aæˆ–Bçš„ç»“æœ',
                    expected: '(A || B)'
                },
                {
                    title: 'æ— æ•ˆï¼šç¼ºå°‘æ“ä½œæ•°çš„å–å',
                    rule: '~',
                    explanation: 'å–åæ“ä½œç¬¦åç¼ºå°‘æ“ä½œæ•°ï¼Œåº”è¯¥æŠ¥é”™',
                    shouldFail: true
                },
                {
                    title: 'æ— æ•ˆï¼šç¼ºå°‘å³æ“ä½œæ•°çš„ä¸è¿ç®—',
                    rule: 'A&&',
                    explanation: 'ä¸æ“ä½œç¬¦ç¼ºå°‘å³æ“ä½œæ•°ï¼Œåº”è¯¥æŠ¥é”™',
                    shouldFail: true
                }
            ],
            multiRule: [
                {
                    title: 'ä¸‰è§„åˆ™ä¸è¿ç®—',
                    rule: 'A&&B&&C',
                    explanation: 'ä¸‰ä¸ªè§„åˆ™çš„ä¸è¿ç®—ï¼Œå·¦ç»“åˆ',
                    expected: '((A && B) && C)'
                },
                {
                    title: 'ä¸‰è§„åˆ™æˆ–è¿ç®—',
                    rule: 'A||B||C',
                    explanation: 'ä¸‰ä¸ªè§„åˆ™çš„æˆ–è¿ç®—ï¼Œå·¦ç»“åˆ',
                    expected: '((A || B) || C)'
                },
                {
                    title: 'å››è§„åˆ™æ··åˆè¿ç®—',
                    rule: 'A&&B||C&&D',
                    explanation: '&&ä¼˜å…ˆçº§é«˜äº||',
                    expected: '((A && B) || (C && D))'
                },
                {
                    title: 'äº”è§„åˆ™å¤æ‚è¿ç®—',
                    rule: 'A||B&&C!D||E',
                    explanation: 'å¤æ‚çš„å¤šè§„åˆ™è¿ç®—',
                    expected: '((A || (B && (C ! D))) || E)'
                }
            ],
            associativity: [
                {
                    title: 'å–åå³ç»“åˆæ€§',
                    rule: '~~A',
                    explanation: 'è¿ç»­å–åï¼Œå³ç»“åˆï¼š~(~A)',
                    expected: '~(~(A))'
                },
                {
                    title: 'å·®é›†å·¦ç»“åˆæ€§',
                    rule: 'A!B!C',
                    explanation: 'è¿ç»­å·®é›†ï¼Œå·¦ç»“åˆï¼š(A!B)!C',
                    expected: '((A ! B) ! C)'
                },
                {
                    title: 'ä¸è¿ç®—å·¦ç»“åˆæ€§',
                    rule: 'A&&B&&C&&D',
                    explanation: 'è¿ç»­ä¸è¿ç®—ï¼Œå·¦ç»“åˆ',
                    expected: '(((A && B) && C) && D)'
                },
                {
                    title: 'æˆ–è¿ç®—å·¦ç»“åˆæ€§',
                    rule: 'A||B||C||D',
                    explanation: 'è¿ç»­æˆ–è¿ç®—ï¼Œå·¦ç»“åˆ',
                    expected: '(((A || B) || C) || D)'
                },
                {
                    title: 'æ··åˆç»“åˆæ€§æµ‹è¯•',
                    rule: '~A!~B',
                    explanation: 'å–åå³ç»“åˆï¼Œå·®é›†å·¦ç»“åˆ',
                    expected: '(~(A) ! ~(B))'
                }
            ],
            precedence: [
                {
                    title: 'å–åä¼˜å…ˆçº§æœ€é«˜',
                    rule: '~A&&B',
                    explanation: '~ä¼˜å…ˆçº§4ï¼Œ&&ä¼˜å…ˆçº§2ï¼Œå…ˆå–åå†ä¸è¿ç®—',
                    expected: '(~(A) && B)'
                },
                {
                    title: 'å·®é›†ä¼˜å…ˆçº§é«˜äºä¸è¿ç®—',
                    rule: 'A!B&&C',
                    explanation: '!ä¼˜å…ˆçº§3ï¼Œ&&ä¼˜å…ˆçº§2ï¼Œå…ˆå·®é›†å†ä¸è¿ç®—',
                    expected: '((A ! B) && C)'
                },
                {
                    title: 'ä¸è¿ç®—ä¼˜å…ˆçº§é«˜äºæˆ–è¿ç®—',
                    rule: 'A||B&&C',
                    explanation: '&&ä¼˜å…ˆçº§2ï¼Œ||ä¼˜å…ˆçº§1ï¼Œå…ˆä¸è¿ç®—å†æˆ–è¿ç®—',
                    expected: '(A || (B && C))'
                },
                {
                    title: 'å¤æ‚ä¼˜å…ˆçº§æµ‹è¯•',
                    rule: 'A||B&&C!~D',
                    explanation: 'æŒ‰ä¼˜å…ˆçº§ï¼š~D, C!~D, B&&(C!~D), A||(B&&(C!~D))',
                    expected: '(A || (B && (C ! ~(D))))'
                },
                {
                    title: 'å…¨è¿ç®—ç¬¦ä¼˜å…ˆçº§',
                    rule: '~A!B&&C||D',
                    explanation: 'å®Œæ•´çš„ä¼˜å…ˆçº§æµ‹è¯•ï¼š~(4) > !(3) > &&(2) > ||(1)',
                    expected: '(((~(A) ! B) && C) || D)'
                }
            ],
            parentheses: [
                {
                    title: 'æ‹¬å·æ”¹å˜å–åèŒƒå›´',
                    rule: '~(A&&B)',
                    explanation: 'æ‹¬å·ä½¿å–åä½œç”¨äºæ•´ä¸ªä¸è¿ç®—ç»“æœ',
                    expected: '~((A && B))'
                },
                {
                    title: 'æ‹¬å·æ”¹å˜æˆ–è¿ç®—ä¼˜å…ˆçº§',
                    rule: '(A||B)&&C',
                    explanation: 'æ‹¬å·ä½¿æˆ–è¿ç®—å…ˆäºä¸è¿ç®—æ‰§è¡Œ',
                    expected: '((A || B) && C)'
                },
                {
                    title: 'åµŒå¥—æ‹¬å·',
                    rule: '~((A||B)&&C)',
                    explanation: 'åµŒå¥—æ‹¬å·çš„å¤æ‚è¡¨è¾¾å¼',
                    expected: '~(((A || B) && C))'
                },
                {
                    title: 'å¤šå±‚æ‹¬å·æ”¹å˜ä¼˜å…ˆçº§',
                    rule: '(A||B)&&(C!D)',
                    explanation: 'æ‹¬å·åˆ†ç»„æ”¹å˜è¿ç®—é¡ºåº',
                    expected: '((A || B) && (C ! D))'
                },
                {
                    title: 'æ‹¬å·ä¸å–åç»„åˆ',
                    rule: '~A||(~B&&C)',
                    explanation: 'æ‹¬å·ä¸å–åçš„å¤æ‚ç»„åˆ',
                    expected: '(~(A) || (~(B) && C))'
                },
                {
                    title: 'æ— æ•ˆï¼šæ‹¬å·ä¸åŒ¹é…',
                    rule: '(A&&B',
                    explanation: 'ç¼ºå°‘å³æ‹¬å·ï¼Œåº”è¯¥æŠ¥é”™',
                    shouldFail: true
                },
                {
                    title: 'æ— æ•ˆï¼šå¤šä½™çš„å³æ‹¬å·',
                    rule: 'A&&B)',
                    explanation: 'å¤šä½™çš„å³æ‹¬å·ï¼Œåº”è¯¥æŠ¥é”™',
                    shouldFail: true
                }
            ]
        };

        function runTest(testCase) {
            const result = engine.validateCombinedRule(testCase.rule);
            
            let resultHtml = '';
            if (testCase.shouldFail) {
                if (!result.success) {
                    resultHtml = `<div class="test-result success">âœ“ æ­£ç¡®æ£€æµ‹åˆ°é”™è¯¯: ${result.error}</div>`;
                } else {
                    resultHtml = `<div class="test-result error">âœ— åº”è¯¥å¤±è´¥ä½†æˆåŠŸäº†</div>`;
                }
            } else {
                if (result.success) {
                    const actualExpression = engine.astToString(result.ast);
                    if (testCase.expected && actualExpression === testCase.expected) {
                        resultHtml = `<div class="test-result success">âœ“ è§£ææˆåŠŸï¼Œç»“æœæ­£ç¡®: ${actualExpression}</div>`;
                    } else if (testCase.expected) {
                        resultHtml = `<div class="test-result warning">âš  è§£ææˆåŠŸä½†ç»“æœä¸ç¬¦é¢„æœŸ<br>æœŸæœ›: ${testCase.expected}<br>å®é™…: ${actualExpression}</div>`;
                    } else {
                        resultHtml = `<div class="test-result success">âœ“ è§£ææˆåŠŸ: ${actualExpression}</div>`;
                    }
                } else {
                    resultHtml = `<div class="test-result error">âœ— è§£æå¤±è´¥: ${result.error}</div>`;
                }
            }
            
            return resultHtml;
        }

        function runTestCategory(categoryName, containerId) {
            const container = document.getElementById(containerId);
            const tests = testCases[categoryName];
            
            let html = '';
            let passed = 0;
            let total = tests.length;
            
            tests.forEach(testCase => {
                const resultHtml = runTest(testCase);
                const isSuccess = resultHtml.includes('class="test-result success"');
                if (isSuccess) passed++;
                
                html += `
                    <div class="test-case">
                        <div class="test-title">${testCase.title}</div>
                        <div class="test-rule">::${testCase.rule}</div>
                        <div class="test-explanation">${testCase.explanation}</div>
                        ${resultHtml}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            return { passed, total };
        }

        function runAllTests() {
            const results = {
                basic: runTestCategory('basic', 'basic-tests'),
                multiRule: runTestCategory('multiRule', 'multi-rule-tests'),
                associativity: runTestCategory('associativity', 'associativity-tests'),
                precedence: runTestCategory('precedence', 'precedence-tests'),
                parentheses: runTestCategory('parentheses', 'parentheses-tests')
            };
            
            // æ˜¾ç¤ºæ€»ç»“
            let totalPassed = 0;
            let totalTests = 0;
            let summaryHtml = '<h4>å„ç±»åˆ«æµ‹è¯•ç»“æœï¼š</h4><ul>';
            
            Object.keys(results).forEach(category => {
                const { passed, total } = results[category];
                totalPassed += passed;
                totalTests += total;
                const percentage = ((passed / total) * 100).toFixed(1);
                summaryHtml += `<li><strong>${getCategoryName(category)}</strong>: ${passed}/${total} (${percentage}%)</li>`;
            });
            
            summaryHtml += '</ul>';
            summaryHtml += `<h4>æ€»ä½“ç»“æœï¼š${totalPassed}/${totalTests} (${((totalPassed/totalTests)*100).toFixed(1)}%)</h4>`;
            
            if (totalPassed === totalTests) {
                summaryHtml += '<div class="test-result success">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç»„åˆè¿ç®—ç¬¦éªŒè¯å®Œå…¨æ­£ç¡®ã€‚</div>';
            } else {
                summaryHtml += '<div class="test-result warning">âš  éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥å®ç°ã€‚</div>';
            }
            
            document.getElementById('summary-content').innerHTML = summaryHtml;
            document.getElementById('test-summary').style.display = 'block';
        }

        function getCategoryName(category) {
            const names = {
                basic: 'åŸºç¡€è¿ç®—ç¬¦',
                multiRule: 'å¤šè§„åˆ™ç»„åˆ',
                associativity: 'ç»“åˆå¾‹',
                precedence: 'ä¼˜å…ˆçº§',
                parentheses: 'æ‹¬å·ä¼˜å…ˆçº§'
            };
            return names[category] || category;
        }

        function clearResults() {
            ['basic-tests', 'multi-rule-tests', 'associativity-tests', 'precedence-tests', 'parentheses-tests'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            document.getElementById('test-summary').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            runAllTests();
        };
    </script>
</body>
</html>