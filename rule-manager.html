<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËßÑÂàôÁÆ°ÁêÜ - ÂçïËØçÁ≠õÈÄâÂ∑•ÂÖ∑</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .rule-manager-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .rule-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .rule-manager-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 60vh;
        }

        .rule-panels {
            display: flex;
            gap: 20px;
        }

        .rule-examples-panel {
            flex: 1;
            max-width: 50%;
            min-height: 400px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .rule-editor-panel {
            flex: 1;
            max-width: 50%;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-title {
            margin: 0 0 20px 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .rule-textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            background: #f8fafc;
            transition: border-color 0.3s ease;
        }

        .rule-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .example-section {
            margin-bottom: 25px;
        }

        .example-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .example-title::before {
            content: "üìù";
            margin-right: 8px;
        }

        .example-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
            margin-bottom: 10px;
        }

        .example-description {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-left: 4px solid #667eea;
            border-radius: 0 4px 4px 0;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4a5568;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .copy-btn:hover {
            opacity: 1;
        }

        .rule-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .saved-rules-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .saved-rules-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .saved-rules-header h2 {
            margin: 0;
        }

        .saved-rules-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px 0;
            min-height: 100px;
        }

        .saved-rules-container.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(-30px);
        }

        .rule-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
            min-height: 120px;
        }

        .rule-item:hover {
            background: #edf2f7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .rule-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .rule-item-name {
            font-weight: 600;
            color: #2d3748;
            flex-shrink: 0;
        }

        .rule-item-content {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            color: #718096;
            background: #e2e8f0;
            padding: 8px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: nowrap;
            margin-top: 8px;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .rule-item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        .syntax-help {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .syntax-help h4 {
            color: #c53030;
            margin-bottom: 10px;
        }

        .syntax-list {
            list-style: none;
            padding: 0;
        }

        .syntax-list li {
            padding: 5px 0;
            border-bottom: 1px solid #fed7d7;
        }

        .syntax-list li:last-child {
            border-bottom: none;
        }

        .syntax-code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 3px;
            color: #2d3748;
        }

        .global-sets-editor {
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .global-sets-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .global-sets-display {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .global-sets-display h4 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .global-sets-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .global-set-item {
            background: #dbeafe;
            color: #1e40af;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid #93c5fd;
        }

        .rule-tree {
            list-style: none;
            padding: 0;
            margin: 0;
            font-family: 'Courier New', monospace;
        }

        .rule-tree-item {
            margin-bottom: 8px;
        }

        .rule-group {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .rule-group-header {
            background: #edf2f7;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
            user-select: none;
        }

        .rule-group-header:hover {
            background: #e2e8f0;
        }

        .rule-group-title {
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            flex: 1;
        }

        .rule-group-toggle {
            font-size: 12px;
            color: #718096;
            transition: transform 0.3s ease;
            width: 16px;
            text-align: center;
        }

        .rule-group.collapsed .rule-group-toggle {
            transform: rotate(-90deg);
        }

        .rule-group.expanded .rule-group-toggle {
            transform: rotate(90deg);
        }

        .rule-group-content {
            padding: 0;
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .rule-group.collapsed .rule-group-content {
            max-height: 0;
        }

        .rule-group.expanded .rule-group-content {
            display: block;
        }

        .rule-sub-item {
            padding: 12px 20px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            transition: background-color 0.3s ease;
            cursor: move;
        }

        .rule-sub-item:hover {
            background: #f8fafc;
        }

        .rule-sub-item:last-child {
            border-bottom: none;
        }

        .rule-sub-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .rule-sub-info {
            flex: 1;
        }

        .rule-sub-name {
            font-weight: 500;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .rule-sub-preview {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            color: #718096;
            background: #f1f5f9;
            padding: 4px 6px;
            border-radius: 3px;
        }

        .rule-sub-actions {
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .rule-sub-item:hover .rule-sub-actions {
            opacity: 1;
        }

        .drag-handle {
            color: #cbd5e0;
            cursor: move;
            margin-right: 8px;
            font-size: 14px;
        }

        .drag-handle:hover {
            color: #a0aec0;
        }

        @media (max-width: 1024px) {
            .rule-panels {
                flex-direction: column;
            }

            .rule-examples-panel,
            .rule-editor-panel {
                max-width: 100%;
                flex: none;
            }
        }

        @media (max-width: 768px) {
            .rule-manager-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .rule-actions {
                justify-content: center;
                flex-wrap: wrap;
            }

            .rule-panels {
                flex-direction: column;
                gap: 15px;
            }

            .rule-examples-panel,
            .rule-editor-panel {
                max-width: 100%;
                flex: none;
                min-height: auto;
            }

            .rule-textarea {
                min-height: 200px;
            }

            .global-sets-textarea {
                min-height: 120px;
            }
        }
    </style>
</head>

<body>
    <div class="rule-manager-container">
        <header class="rule-manager-header">
            <div>
                <h1>ËßÑÂàôÁÆ°ÁêÜ</h1>
                <p>ÂàõÂª∫ÂíåÁÆ°ÁêÜÂçïËØçÁ≠õÈÄâËßÑÂàô</p>
            </div>
            <div class="header-buttons">
                <button id="backToMainBtn" class="btn btn-help">ËøîÂõû‰∏ªÈ°µ</button>
            </div>
        </header>

        <!-- ‰∏äÂçäÂå∫ÔºöÂ∑¶Âè≥Â∏ÉÂ±Ä -->
        <div class="rule-manager-content">
            <div class="rule-panels">
                <!-- Â∑¶‰æßÔºöÁ§∫‰æãÂå∫Âüü -->
                <div class="rule-examples-panel">
                    <h3 class="panel-title">ËßÑÂàôÁ§∫‰æã</h3>

                    <div class="example-section">
                        <div class="example-title">Âü∫Á°ÄCVCÊ®°Âºè</div>
                        <div class="example-code">
                            <button class="copy-btn" onclick="copyExample(this)">Â§çÂà∂</button>
                            #CVCÊ®°Âºè
                            !\bCVC\e
                            @
                        </div>
                        <div class="example-description">
                            ÂÆö‰πâÂêçÁß∞ÔºöCVCÊ®°Âºè<br>
                            ÂºïÁî®ÂÖ®Â±ÄÈõÜÂêàÔºöCÔºàËæÖÈü≥Ôºâ„ÄÅVÔºàÂÖÉÈü≥Ôºâ<br>
                            ÂåπÈÖçÊ®°ÂºèÔºö\bË°®Á§∫ÂçïËØçÂºÄÂ§¥Ôºå\eË°®Á§∫ÂçïËØçÁªìÂ∞æÔºåÂÆåÊï¥ÂåπÈÖçËæÖÈü≥-ÂÖÉÈü≥-ËæÖÈü≥ÁªìÊûÑ<br>
                            ÊéíÂ∫èÊñπÂºèÔºöÈªòËÆ§ÊéíÂ∫è
                        </div>
                    </div>

                    <div class="example-section">
                        <div class="example-title">CVCEÊ®°ÂºèÔºàÈ≠îÊ≥ïEÔºâ</div>
                        <div class="example-code">
                            <button class="copy-btn" onclick="copyExample(this)">Â§çÂà∂</button>
                            #CVCEÊ®°Âºè
                            !\bCVC[e]\e
                            @
                        </div>
                        <div class="example-description">
                            ÂÆö‰πâÂêçÁß∞ÔºöCVCEÊ®°Âºè<br>
                            ÂºïÁî®ÂÖ®Â±ÄÈõÜÂêàÔºöCÔºàËæÖÈü≥Ôºâ„ÄÅVÔºàÂÖÉÈü≥Ôºâ<br>
                            ÂåπÈÖçÊ®°ÂºèÔºö\bË°®Á§∫ÂçïËØçÂºÄÂ§¥Ôºå[e]Ë°®Á§∫Â≠óÈù¢Â≠óÁ¨¶eÔºå\eË°®Á§∫ÂçïËØçÁªìÂ∞æÔºåÂÆåÊï¥ÂåπÈÖçËæÖÈü≥-ÂÖÉÈü≥-ËæÖÈü≥-eÁªìÊûÑ<br>
                            ÊéíÂ∫èÊñπÂºèÔºöÈªòËÆ§ÊéíÂ∫è
                        </div>
                    </div>

                    <div class="example-section">
                        <div class="example-title">ÂèåËæÖÈü≥ÂºÄÂ§¥ÔºàÈÉ®ÂàÜÂåπÈÖçÔºâ</div>
                        <div class="example-code">
                            <button class="copy-btn" onclick="copyExample(this)">Â§çÂà∂</button>
                            #ÂèåËæÖÈü≥ÂºÄÂ§¥
                            BL=={bl,br,cl,cr,dr,fl,fr,gl,gr,pl,pr,sc,sk,sl,sm,sn,sp,st,sw,tr,tw}
                            !\b(BL)VC
                            @(BL)
                        </div>
                        <div class="example-description">
                            ÂÆö‰πâÂêçÁß∞ÔºöÂèåËæÖÈü≥ÂºÄÂ§¥<br>
                            ÂÆö‰πâÂ±ÄÈÉ®ÈõÜÂêàÔºöBLÔºàÂèåËæÖÈü≥ÁªÑÂêàÔºå‰∏§‰∏™Â≠óÊØç‰ª•‰∏äÈúÄÁî®Êã¨Âè∑ÂºïÁî®Ôºâ<br>
                            ÂºïÁî®ÂÖ®Â±ÄÈõÜÂêàÔºöVÔºàÂÖÉÈü≥Ôºâ„ÄÅCÔºàËæÖÈü≥Ôºâ<br>
                            ÂåπÈÖçÊ®°ÂºèÔºö\bË°®Á§∫ÂçïËØçÂºÄÂ§¥ÔºåÊîØÊåÅÈÉ®ÂàÜÂåπÈÖç<br>
                            ÊéíÂ∫èÊñπÂºèÔºöÊåâÂèåËæÖÈü≥Á±ªÂûãÂàÜÁªÑ
                        </div>
                    </div>

                    <div class="example-section">
                        <div class="example-title">ÈïøÂ∫¶ÈôêÂà∂</div>
                        <div class="example-code">
                            <button class="copy-btn" onclick="copyExample(this)">Â§çÂà∂</button>
                            #ÂõõÂ≠óÊØçÂçïËØç
                            !LLLL
                            @
                        </div>
                        <div class="example-description">
                            ÂÆö‰πâÂêçÁß∞ÔºöÂõõÂ≠óÊØçÂçïËØç<br>
                            ÂºïÁî®ÂÖ®Â±ÄÈõÜÂêàÔºöLÔºàÊâÄÊúâÂ≠óÊØçÔºâ<br>
                            ÂåπÈÖçÊ®°ÂºèÔºöÂåÖÂê´Âõõ‰∏™ËøûÁª≠Â≠óÊØçÔºàÈÉ®ÂàÜÂåπÈÖçÔºåÈáçÂ§çLÂõõÊ¨°Ôºâ<br>
                            ÊéíÂ∫èÊñπÂºèÔºöÈªòËÆ§ÊéíÂ∫è<br>
                            Ê≥®ÔºöÂ¶ÇÈúÄÊÅ∞Â•ΩÂõõ‰∏™Â≠óÊØçÔºåËØ∑‰ΩøÁî®\bLLLL\eÔºõÂ¶ÇÈúÄÊõ¥Â§çÊùÇÁöÑÈïøÂ∫¶ÂåπÈÖçÔºåÂèØÂÆö‰πâÂ±ÄÈÉ®ÈõÜÂêàÊàñ‰ΩøÁî®ÁªÑÂêàËßÑÂàô
                        </div>
                    </div>

                    <div class="example-section">
                        <div class="example-title">ÁªÑÂêàËßÑÂàô</div>
                        <div class="example-code">
                            <button class="copy-btn" onclick="copyExample(this)">Â§çÂà∂</button>
                            #CVCÊàñCVCE
                            !!CVCÊ®°Âºè||CVCEÊ®°Âºè
                            @
                        </div>
                        <div class="example-description">
                            ÂÆö‰πâÂêçÁß∞ÔºöCVCÊàñCVCE<br>
                            ÂÆö‰πâÈõÜÂêàÔºöÊó†Ôºà‰ΩøÁî®Â∑≤ÂÆö‰πâËßÑÂàôÔºâ<br>
                            ÂåπÈÖçÊ®°ÂºèÔºöCVCÊ®°ÂºèÊàñCVCEÊ®°Âºè<br>
                            ÊéíÂ∫èÊñπÂºèÔºöÈªòËÆ§ÊéíÂ∫è
                        </div>
                    </div>
                </div>

                <!-- ËßÑÂàôÁºñËæëÂô® -->
                <div class="rule-editor-panel">
                    <h3 class="panel-title">ËßÑÂàôÁºñËæëÂô®</h3>

                    <div class="syntax-help">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4>Âø´ÈÄüËØ≠Ê≥ïÊèêÁ§∫</h4>
                            <button id="detailedHelpBtn" class="btn btn-help btn-small">ËØ¶ÁªÜËØ≠Ê≥ïÂ∏ÆÂä©</button>
                        </div>
                        <ul class="syntax-list">
                            <li><span class="syntax-code">#ËßÑÂàôÂêç</span> - ÂÆö‰πâËßÑÂàôÂêçÁß∞Ôºà‰ª•#ÂºÄÂ§¥Ôºâ</li>
                            <li><span class="syntax-code">ÈõÜÂêàÂêç=={ÂÖÉÁ¥†1,ÂÖÉÁ¥†2,...}</span> - ÂÆö‰πâÂ±ÄÈÉ®ÈõÜÂêàÔºà‰ªÖÂú®ÂΩìÂâçËßÑÂàôÂÜÖÊúâÊïàÔºâ</li>
                            <li><span class="syntax-code">(ÈõÜÂêàÂêç)</span> - ÂºïÁî®ÈõÜÂêàÔºàÂçïÂ≠óÊØçÈõÜÂêàÂøÖÈ°ªÂ§ßÂÜôÔºåÂ§öÂ≠óÊØçÈõÜÂêàÂ§ßÂ∞èÂÜôÊïèÊÑü‰∏îÂøÖÈ°ªÁî®Êã¨Âè∑Ôºâ</li>
                            <li><span class="syntax-code">!ÂÖ∑‰ΩìËßÑÂàô</span> - ÂÆö‰πâÂåπÈÖçÊ®°Âºè</li>
                            <li><span class="syntax-code">@ÊòæÁ§∫ËßÑÂàô</span> - ÂÆö‰πâÊéíÂ∫èÊñπÂºèÔºàÂèØÈÄâÔºâ</li>
                            <li><span class="syntax-code">\b</span> - ÂçïËØçÂºÄÂ§¥Ôºå<span class="syntax-code">\e</span> -
                                ÂçïËØçÁªìÂ∞æÔºå<span class="syntax-code">\m</span> - ÂçïËØç‰∏≠Èó¥</li>
                        </ul>
                    </div>

                    <!-- ÂÖ®Â±ÄÈõÜÂêàÁºñËæëÂå∫ -->
                    <div class="global-sets-editor">
                        <h4>ÂÖ®Â±ÄÈõÜÂêàÂÆö‰πâ</h4>
                        <textarea id="globalSetsEditor" class="global-sets-textarea"
                            placeholder="Âú®Ê≠§ÂÆö‰πâÂÖ®Â±ÄÈõÜÂêàÔºåÊØèË°å‰∏Ä‰∏™ÈõÜÂêàÂÆö‰πâÔºåÊ†ºÂºèÔºöÈõÜÂêàÂêç=={ÂÖÉÁ¥†1,ÂÖÉÁ¥†2,...}\n‰æãÂ¶ÇÔºö\nC=={b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z}\nV=={a,e,i,o,u}">C=={b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z}\nV=={a,e,i,o,u}\nL=={a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z}</textarea>
                        <button id="updateGlobalSetsBtn" class="btn btn-secondary">Êõ¥Êñ∞ÂÖ®Â±ÄÈõÜÂêà</button>
                    </div>



                    <textarea id="ruleEditor" class="rule-textarea" placeholder="Âú®Ê≠§ËæìÂÖ•ËßÑÂàôÂÆö‰πâ...
Ê≥®ÊÑèÔºö
- ÈõÜÂêàÂÆö‰πâ‰ªÖÂú®ÂΩìÂâçËßÑÂàôÂÜÖÊúâÊïà
- ‰ΩøÁî®(ÈõÜÂêàÂêç)ÂºïÁî®ÂÖ®Â±ÄÈõÜÂêà
- ‰∏çÂÖÅËÆ∏‰ΩøÁî®Â§ßÂÜôÂ≠óÊØçÁªÑÂêàÁõ¥Êé•ÂÆö‰πâÈõÜÂêà"></textarea>

                    <div class="rule-actions">
                        <button id="saveRuleBtn" class="btn btn-primary">‰øùÂ≠òËßÑÂàô</button>
                        <button id="testRuleBtn" class="btn btn-secondary">ÊµãËØïËßÑÂàô</button>
                        <button id="clearRuleBtn" class="btn btn-outline">Ê∏ÖÁ©∫ÁºñËæëÂô®</button>
                        <button id="formatRuleBtn" class="btn btn-outline">Ê†ºÂºèÂåñ</button>
                    </div>
                </div>
            </div>

            <!-- ‰∏ãÂçäÂå∫ÔºöÂ∑≤‰øùÂ≠òÁöÑËßÑÂàô -->
            <div class="saved-rules-section">
                <div class="saved-rules-header">
                    <h2>Â∑≤‰øùÂ≠òÁöÑËßÑÂàô</h2>
                    <div style="margin-left: auto; display: flex; gap: 10px;">
                        <button id="exportRulesBtn" class="btn btn-secondary">ÂØºÂá∫ËßÑÂàô</button>
                        <button id="importRulesBtn" class="btn btn-secondary">ÂØºÂÖ•ËßÑÂàô</button>
                        <button id="clearAllRulesBtn" class="btn btn-danger" onclick="ruleManager.clearAllRules()">
                            üóëÔ∏è Ê∏ÖÈô§ÊâÄÊúâËßÑÂàô
                        </button>
                    </div>
                </div>
                <div id="savedRulesContainer" class="saved-rules-container"></div>
            </div>
        </div>
    </div>

    <!-- Ê∂àÊÅØÊèêÁ§∫ -->
    <div id="messageContainer" class="message-container"></div>

    <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
        <div class="spinner"></div>
        <p>Ê≠£Âú®Â§ÑÁêÜ...</p>
    </div>

    <!-- ËØ¶ÁªÜÂ∏ÆÂä©Ê®°ÊÄÅÊ°Ü -->
    <div id="detailedHelpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ËßÑÂàôËØ≠Ê≥ïËØ¶ÁªÜÂ∏ÆÂä©</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <h4>Âü∫Êú¨ËØ≠Ê≥ï</h4>
                    <ul>
                        <li><strong>#ËßÑÂàôÂêç</strong> - ÂÆö‰πâËßÑÂàôÂêçÁß∞</li>
                        <li><strong>ÈõÜÂêàÂÆö‰πâ</strong> - C=={b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z}</li>
                        <li><strong>!ÂÖ∑‰ΩìËßÑÂàô</strong> - ÂÆö‰πâÂåπÈÖçÊ®°Âºè</li>
                        <li><strong>@ÊòæÁ§∫ËßÑÂàô</strong> - ÂÆö‰πâÊéíÂ∫èÊñπÂºè</li>
                    </ul>
                    <h4>‰ΩçÁΩÆÊ†áÂøó</h4>
                    <ul>
                        <li><strong>\b</strong> - ÂçïËØçÂºÄÂ§¥</li>
                        <li><strong>\e</strong> - ÂçïËØçÁªìÂ∞æ</li>
                        <li><strong>\m</strong> - ÂçïËØç‰∏≠Èó¥</li>
                        <li><strong>\-b</strong> - ‰∏çÂú®ÂºÄÂ§¥</li>
                        <li><strong>\-e</strong> - ‰∏çÂú®ÁªìÂ∞æ</li>
                    </ul>
                    <h4>Á§∫‰æãËßÑÂàô</h4>
                    <pre>C=={b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z}
V=={a,e,i,o,u}

#CVC
!\bCVC\e
@

#CVCE
!\bCVC[e]\e
@</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•Â§ñÈÉ®Â∫ì -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- ÂºïÂÖ•Ëá™ÂÆö‰πâËÑöÊú¨ -->
    <script src="js/fileUtils.js"></script>
    <script src="js/fileStorage.js"></script>
    <script src="js/ruleEngine.js"></script>
    <script src="js/version.js"></script>
    <script>
        // ËßÑÂàôÁÆ°ÁêÜÈ°µÈù¢‰∏ìÁî®ËÑöÊú¨
        class RuleManagerApp {
            constructor() {
                this.ruleEngine = new RuleEngine();
                this.initializeApp();
            }

            initializeApp() {
                this.bindEvents();
                this.ruleEngine.loadSavedRules();
                this.loadSavedRules();
                this.initializeGlobalSetsEditor();
            }

            // ÂàùÂßãÂåñÂÖ®Â±ÄÈõÜÂêàÁºñËæëÂô®
            initializeGlobalSetsEditor() {
                const globalSetsEditor = document.getElementById('globalSetsEditor');
                const savedGlobalSets = JSON.parse(localStorage.getItem('globalSets') || '{}');

                let defaultSets = `C=={b,c,d,f,g,h,j,k,l,m,n,p,q,r,s,t,v,w,x,y,z}
V=={a,e,i,o,u}
L=={a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z}`;

                // Ê∑ªÂä†‰øùÂ≠òÁöÑËá™ÂÆö‰πâÈõÜÂêà
                for (const [setName, setValues] of Object.entries(savedGlobalSets)) {
                    if (!['C', 'V', 'L'].includes(setName)) {
                        defaultSets += `
${setName}=={${setValues.join(',')}}`;
                    }
                }

                globalSetsEditor.value = defaultSets;
            }

            bindEvents() {
                // ÂØºÂá∫ËßÑÂàôÊåâÈíÆ
                document.getElementById('exportRulesBtn').addEventListener('click', async () => {
                    await this.exportRules();
                });

                // ÂØºÂÖ•ËßÑÂàôÊåâÈíÆ
                document.getElementById('importRulesBtn').addEventListener('click', () => {
                    this.importRules();
                });

                // ËøîÂõû‰∏ªÈ°µ
                document.getElementById('backToMainBtn').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });

                // ‰øùÂ≠òËßÑÂàô
                document.getElementById('saveRuleBtn').addEventListener('click', () => {
                    this.saveRule();
                });

                // ÊµãËØïËßÑÂàô
                document.getElementById('testRuleBtn').addEventListener('click', () => {
                    this.testRule();
                });

                // Ê∏ÖÁ©∫ÁºñËæëÂô®
                document.getElementById('clearRuleBtn').addEventListener('click', () => {
                    if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÁºñËæëÂô®ÂÜÖÂÆπÂêóÔºü')) {
                        document.getElementById('ruleEditor').value = '';
                    }
                });

                // Ê†ºÂºèÂåñËßÑÂàô
                document.getElementById('formatRuleBtn').addEventListener('click', () => {
                    this.formatRule();
                });

                // Êõ¥Êñ∞ÂÖ®Â±ÄÈõÜÂêà
                document.getElementById('updateGlobalSetsBtn').addEventListener('click', () => {
                    this.updateGlobalSets();
                });

                // ËØ¶ÁªÜÂ∏ÆÂä©ÊåâÈíÆ
                document.getElementById('detailedHelpBtn').addEventListener('click', () => {
                    this.showDetailedHelp();
                });

                // ËØ¶ÁªÜÂ∏ÆÂä©Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠‰∫ã‰ª∂
                const detailedHelpModal = document.getElementById('detailedHelpModal');
                const closeBtn = detailedHelpModal.querySelector('.close');

                closeBtn.addEventListener('click', () => {
                    detailedHelpModal.style.display = 'none';
                });

                // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
                window.addEventListener('click', (event) => {
                    if (event.target === detailedHelpModal) {
                        detailedHelpModal.style.display = 'none';
                    }
                });
            }

            saveRule() {
                const ruleText = document.getElementById('ruleEditor').value.trim();

                if (!ruleText) {
                    this.showMessage('ËØ∑ËæìÂÖ•ËßÑÂàôÂÜÖÂÆπ', 'warning');
                    return;
                }

                // Ê£ÄÊü•ËßÑÂàôÂêçÁß∞ÊòØÂê¶‰ª•#ÂºÄÂ§¥
                const lines = ruleText.split('\n');
                const nameMatch = lines[0].match(/^#(.+)$/);
                if (!nameMatch) {
                    this.showMessage('ËßÑÂàôÂêçÁß∞ÂøÖÈ°ª‰ª•#ÂºÄÂ§¥', 'error');
                    return;
                }

                try {
                    const rule = this.ruleEngine.parseRule(ruleText);

                    // Ê£ÄÊü•ËßÑÂàôÂÜ≤Á™Å
                    const conflicts = this.checkRuleConflicts(rule);
                    if (conflicts.length > 0) {
                        const conflictMsg = `Ê£ÄÊµãÂà∞ËßÑÂàôÂÜ≤Á™Å:\n${conflicts.join('\n')}`;
                        if (!confirm(`${conflictMsg}\n\nÊòØÂê¶‰ªçË¶Å‰øùÂ≠òÊ≠§ËßÑÂàôÔºü`)) {
                            return;
                        }
                    }

                    this.ruleEngine.saveRule(rule);
                    this.loadSavedRules();
                    document.getElementById('ruleEditor').value = '';

                    this.showMessage(`ËßÑÂàô "${rule.name}" ‰øùÂ≠òÊàêÂäü`, 'success');

                } catch (error) {
                    console.error('ËßÑÂàô‰øùÂ≠òÈîôËØØ:', error);
                    this.showMessage(`ËßÑÂàô‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
                }
            }

            testRule() {
                const ruleText = document.getElementById('ruleEditor').value.trim();

                if (!ruleText) {
                    this.showMessage('ËØ∑ËæìÂÖ•ËßÑÂàôÂÜÖÂÆπ', 'warning');
                    return;
                }

                try {
                    const rule = this.ruleEngine.parseRule(ruleText);

                    const testWords = ['apple', 'banana', 'cat', 'dog', 'elephant', 'fish', 'grape', 'house'];
                    const testResults = [];

                    for (const word of testWords) {
                        const matches = this.ruleEngine.matchesRule(word, rule);
                        testResults.push(`${word}: ${matches ? '‚úì' : '‚úó'}`);
                    }

                    const resultText = `ÊµãËØïÁªìÊûú:\n${testResults.join('\n')}`;
                    alert(resultText);

                } catch (error) {
                    console.error('ËßÑÂàôÊµãËØïÈîôËØØ:', error);
                    this.showMessage(`ËßÑÂàôÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
                }
            }

            formatRule() {
                const ruleText = document.getElementById('ruleEditor').value.trim();
                if (!ruleText) return;

                // Ê†ºÂºèÂåñËßÑÂàôÔºö‰∏çÊ∑ªÂä†Á©∫Ë°åÔºå‰øùÊåÅÁ¥ßÂáëÊ†ºÂºè
                const lines = ruleText.split('\n');
                const formattedLines = [];

                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed) { // Âè™‰øùÁïôÈùûÁ©∫Ë°å
                        formattedLines.push(trimmed);
                    }
                }

                document.getElementById('ruleEditor').value = formattedLines.join('\n');
            }

            loadSavedRules() {
                const container = document.getElementById('savedRulesContainer');
                const ruleNames = this.ruleEngine.getRuleNames();

                if (ruleNames.length === 0) {
                    container.className = 'saved-rules-container empty';
                    container.innerHTML = '<div style="color: #a0aec0; font-size: 16px; font-weight: 500;">ÊöÇÊó†‰øùÂ≠òÁöÑËßÑÂàô</div>';
                    return;
                }

                container.className = 'saved-rules-container';

                // Ëé∑Âèñ‰øùÂ≠òÁöÑÊéíÂ∫è
                const savedOrder = this.loadRuleOrder();

                // Êåâ‰øùÂ≠òÁöÑÈ°∫Â∫èÊéíÂ∫èÔºåÊú™ÊéíÂ∫èÁöÑËßÑÂàôÊîæÂú®ÊúÄÂêé
                const orderedRules = [];
                savedOrder.forEach(name => {
                    if (ruleNames.includes(name)) {
                        orderedRules.push(name);
                    }
                });
                ruleNames.forEach(name => {
                    if (!orderedRules.includes(name)) {
                        orderedRules.push(name);
                    }
                });

                // ÊåâÂêçÁß∞ÂàÜÁªÑÔºåÂàõÂª∫Ê†ëÂΩ¢ÁªìÊûÑ
                const ruleGroups = this.groupRulesByName(orderedRules);
                let html = '<div class="rule-tree">';

                for (const [groupName, rules] of Object.entries(ruleGroups)) {
                    if (rules.length === 1) {
                        // Âçï‰∏™ËßÑÂàô
                        const rule = this.ruleEngine.getRule(rules[0]);
                        html += this.createRuleItemHTML(rules[0], rule, false);
                    } else {
                        // ËßÑÂàôÁªÑÔºàÈªòËÆ§Êî∂Áº©Ôºâ
                        html += `
                            <div class="rule-group collapsed">
                                <div class="rule-group-header" onclick="this.parentNode.classList.toggle('collapsed')">
                                    <span class="rule-group-toggle">‚ñ∂</span>
                                    <span class="rule-group-title">${groupName}</span>
                                    <span class="group-count">(${rules.length})</span>
                                </div>
                                <div class="rule-group-content">
                        `;

                        rules.forEach(ruleName => {
                            const rule = this.ruleEngine.getRule(ruleName);
                            html += this.createRuleItemHTML(ruleName, rule, true);
                        });

                        html += `
                                </div>
                            </div>
                        `;
                    }
                }

                html += '</div>';
                container.innerHTML = html;

                // Ê∑ªÂä†ÊãñÊãΩÊéíÂ∫èÂäüËÉΩ
                this.initializeDragAndDrop(container);
            }

            editRule(ruleName) {
                const rule = this.ruleEngine.getRule(ruleName);
                if (!rule) return;

                let ruleText = `#${rule.name}`;

                if (rule.localSets.size > 0) {
                    for (const [setName, setValues] of rule.localSets) {
                        const values = Array.from(setValues).join(',');
                        ruleText += `\n${setName}=={${values}}`;
                    }
                }

                ruleText += `\n${rule.specificRule}`;

                if (rule.displayRule) {
                    ruleText += `\n${rule.displayRule}`;
                }

                document.getElementById('ruleEditor').value = ruleText;
                document.getElementById('ruleEditor').focus();
            }

            deleteRule(ruleName) {
                if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ËßÑÂàô "${ruleName}" ÂêóÔºü`)) {
                    this.ruleEngine.deleteRule(ruleName);
                    this.loadSavedRules();
                    this.showMessage(`ËßÑÂàô "${ruleName}" Â∑≤Âà†Èô§`, 'success');
                }
            }

            showMessage(message, type = 'info') {
                const messageContainer = document.getElementById('messageContainer');

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = message;

                messageContainer.appendChild(messageDiv);

                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 5000);
            }

            // ÊåâÂêçÁß∞ÂàÜÁªÑËßÑÂàô
            groupRulesByName(ruleNames) {
                const groups = {};

                ruleNames.forEach(name => {
                    // ÊèêÂèñÂü∫Á°ÄÂêçÁß∞ÔºàÂéªÊéâÊï∞Â≠óÂêéÁºÄÁ≠âÔºâ
                    const baseName = name.replace(/\d+$/, '').replace(/[_-]\d+$/, '');

                    if (!groups[baseName]) {
                        groups[baseName] = [];
                    }
                    groups[baseName].push(name);
                });

                return groups;
            }

            // ÂàõÂª∫ËßÑÂàôÈ°πHTML
            createRuleItemHTML(ruleName, rule, isInGroup) {
                const ruleText = this.reconstructRuleText(rule);
                return `
                    <div class="rule-item" draggable="true" data-rule-name="${ruleName}">
                        <div class="rule-item-header">
                            <span class="rule-item-name">${ruleName}</span>
                            <div class="rule-item-actions">
                                <button class="btn btn-small btn-outline" onclick="ruleManager.editRule('${ruleName}')">ÁºñËæë</button>
                                <button class="btn btn-small btn-secondary" onclick="ruleManager.deleteRule('${ruleName}')">Âà†Èô§</button>
                            </div>
                        </div>
                        <div class="rule-item-content">${ruleText}</div>
                    </div>
                `;
            }

            // ÈáçÊûÑËßÑÂàôÊñáÊú¨
            reconstructRuleText(rule) {
                let parts = [`#${rule.name}`];

                // Ê∑ªÂä†Â±ÄÈÉ®ÈõÜÂêàÂÆö‰πâ
                if (rule.localSets && rule.localSets.size > 0) {
                    for (const [setName, setValues] of rule.localSets) {
                        const values = Array.isArray(setValues) ? setValues : Array.from(setValues);
                        parts.push(`${setName}=={${values.join(',')}}`);
                    }
                }

                // Ê∑ªÂä†ÂÖ∑‰ΩìËßÑÂàô
                if (rule.specificRule) {
                    parts.push(rule.specificRule);
                }

                // Ê∑ªÂä†ÊòæÁ§∫ËßÑÂàô
                if (rule.displayRule) {
                    parts.push(rule.displayRule);
                } else {
                    parts.push('@');
                }

                return parts.join(' | ');
            }

            // Êõ¥Êñ∞ÂÖ®Â±ÄÈõÜÂêà
            updateGlobalSets() {
                const globalSetsText = document.getElementById('globalSetsEditor').value.trim();

                if (!globalSetsText) {
                    this.showMessage('ËØ∑ËæìÂÖ•ÂÖ®Â±ÄÈõÜÂêàÂÆö‰πâ', 'warning');
                    return;
                }

                try {
                    // Ëß£ÊûêÂÖ®Â±ÄÈõÜÂêàÂÆö‰πâ
                    const lines = globalSetsText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                    const newGlobalSets = new Map();

                    for (const line of lines) {
                        if (line.includes('==')) {
                            const [setName, setDef] = line.split('==');
                            const cleanSetName = setName.trim();

                            // È™åËØÅÈõÜÂêàÂêçÁß∞
                            if (cleanSetName.length === 1) {
                                // ÂçïÂ≠óÊØçÈõÜÂêàÂêçÂøÖÈ°ªÊòØÂ§ßÂÜô
                                if (!/^[A-Z]$/.test(cleanSetName)) {
                                    throw new Error(`ÂçïÂ≠óÊØçÈõÜÂêàÂêç "${cleanSetName}" ÂøÖÈ°ªÊòØÂ§ßÂÜôÂ≠óÊØç`);
                                }
                            } else {
                                // Â§öÂ≠óÊØçÈõÜÂêàÂêçÂú®ÂºïÁî®Êó∂ÈúÄË¶ÅÁî®Êã¨Âè∑
                                console.warn(`ÈõÜÂêàÂêçÁß∞ "${cleanSetName}" ÈïøÂ∫¶Ë∂ÖËøá1‰∏™Â≠óÁ¨¶ÔºåÂú®ÂºïÁî®Êó∂ËØ∑‰ΩøÁî®Êã¨Âè∑Ôºö(${cleanSetName})`);
                            }

                            const setValues = this.parseSetValues(setDef.trim());
                            newGlobalSets.set(cleanSetName, setValues);
                        }
                    }

                    // Êõ¥Êñ∞RuleEngine‰∏≠ÁöÑÂÖ®Â±ÄÈõÜÂêà
                    this.ruleEngine.updateGlobalSets(newGlobalSets);

                    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                    const globalSetsData = {};
                    for (const [setName, setValues] of newGlobalSets) {
                        globalSetsData[setName] = Array.from(setValues);
                    }
                    localStorage.setItem('globalSets', JSON.stringify(globalSetsData));

                    this.showMessage('ÂÖ®Â±ÄÈõÜÂêàÊõ¥Êñ∞ÊàêÂäü', 'success');

                } catch (error) {
                    console.error('ÂÖ®Â±ÄÈõÜÂêàÊõ¥Êñ∞ÈîôËØØ:', error);
                    this.showMessage(`ÂÖ®Â±ÄÈõÜÂêàÊõ¥Êñ∞Â§±Ë¥•: ${error.message}`, 'error');
                }
            }

            // Ëß£ÊûêÈõÜÂêàÂÄº
            parseSetValues(setDef) {
                if (setDef.startsWith('{') && setDef.endsWith('}')) {
                    const content = setDef.slice(1, -1);
                    return new Set(content.split(',').map(item => item.trim()).filter(item => item.length > 0));
                }
                throw new Error(`ÈõÜÂêàÂÆö‰πâÊ†ºÂºèÈîôËØØ: ${setDef}`);
            }

            // ÂàùÂßãÂåñÊãñÊãΩÊéíÂ∫è
            initializeDragAndDrop(container) {
                let draggedElement = null;

                container.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('rule-item')) {
                        draggedElement = e.target;
                        e.target.classList.add('dragging');
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/html', e.target.outerHTML);
                    }
                });

                container.addEventListener('dragend', (e) => {
                    if (e.target.classList.contains('rule-item')) {
                        e.target.classList.remove('dragging');
                        // Ê∏ÖÈô§ÊâÄÊúâÊãñÊãΩÊåáÁ§∫Âô®
                        container.querySelectorAll('.drag-over').forEach(el => {
                            el.classList.remove('drag-over');
                        });
                        draggedElement = null;
                    }
                });

                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';

                    const afterElement = this.getDragAfterElement(container, e.clientY);
                    const draggables = [...container.querySelectorAll('.rule-item:not(.dragging)')];

                    // Ê∏ÖÈô§‰πãÂâçÁöÑÊåáÁ§∫Âô®
                    draggables.forEach(el => el.classList.remove('drag-over'));

                    // Ê∑ªÂä†Êñ∞ÁöÑÊåáÁ§∫Âô®
                    if (afterElement) {
                        afterElement.classList.add('drag-over');
                    }
                });

                container.addEventListener('drop', (e) => {
                    e.preventDefault();

                    if (draggedElement) {
                        const afterElement = this.getDragAfterElement(container, e.clientY);

                        if (afterElement == null) {
                            container.appendChild(draggedElement);
                        } else {
                            container.insertBefore(draggedElement, afterElement);
                        }

                        // ‰øùÂ≠òÊñ∞ÁöÑÊéíÂ∫èÂà∞Êú¨Âú∞Â≠òÂÇ®
                        this.saveRuleOrder();
                        this.showMessage('ËßÑÂàôÊéíÂ∫èÂ∑≤Êõ¥Êñ∞', 'success');
                    }

                    // Ê∏ÖÈô§ÊãñÊãΩÊåáÁ§∫Âô®
                    container.querySelectorAll('.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                });

                container.addEventListener('dragleave', (e) => {
                    // ÂΩìÊãñÊãΩÁ¶ªÂºÄÂÆπÂô®Êó∂Ê∏ÖÈô§ÊåáÁ§∫Âô®
                    if (!container.contains(e.relatedTarget)) {
                        container.querySelectorAll('.drag-over').forEach(el => {
                            el.classList.remove('drag-over');
                        });
                    }
                });
            }

            // Ëé∑ÂèñÊãñÊãΩÂêéÁöÑ‰ΩçÁΩÆ
            getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.rule-item:not(.dragging)')];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;

                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            // ‰øùÂ≠òËßÑÂàôÊéíÂ∫è
            saveRuleOrder() {
                const ruleItems = [...document.querySelectorAll('.rule-item[data-rule-name]')];
                const order = ruleItems.map(item => item.getAttribute('data-rule-name'));
                localStorage.setItem('ruleOrder', JSON.stringify(order));
            }

            // Âä†ËΩΩËßÑÂàôÊéíÂ∫è
            loadRuleOrder() {
                const savedOrder = localStorage.getItem('ruleOrder');
                return savedOrder ? JSON.parse(savedOrder) : [];
            }

            // Ê£ÄÊü•ËßÑÂàôÂÜ≤Á™Å
            checkRuleConflicts(newRule) {
                const conflicts = [];
                const existingRules = this.ruleEngine.getRuleNames();

                // Ê£ÄÊü•ÂêçÁß∞ÂÜ≤Á™Å
                if (existingRules.includes(newRule.name)) {
                    conflicts.push(`ËßÑÂàôÂêçÁß∞ "${newRule.name}" Â∑≤Â≠òÂú®`);
                }

                // Ê£ÄÊü•ÈõÜÂêàÂÆö‰πâÂÜ≤Á™Å
                for (const [setName, setValues] of newRule.localSets) {
                    for (const existingRuleName of existingRules) {
                        const existingRule = this.ruleEngine.getRule(existingRuleName);
                        if (existingRule.localSets.has(setName)) {
                            const existingValues = existingRule.localSets.get(setName);
                            const newValues = Array.from(setValues).sort();
                            const oldValues = Array.from(existingValues).sort();

                            if (JSON.stringify(newValues) !== JSON.stringify(oldValues)) {
                                conflicts.push(`ÈõÜÂêà "${setName}" Âú®ËßÑÂàô "${existingRuleName}" ‰∏≠Êúâ‰∏çÂêåÂÆö‰πâ`);
                            }
                        }
                    }
                }

                return conflicts;
            }

            // Ê∏ÖÈô§ÊâÄÊúâÂ∑≤‰øùÂ≠òÁöÑËßÑÂàô
            clearAllRules() {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂ∑≤‰øùÂ≠òÁöÑËßÑÂàôÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ')) {
                    // Ê∏ÖÈô§RuleEngine‰∏≠ÁöÑÊâÄÊúâËßÑÂàô
                    const ruleNames = this.ruleEngine.getRuleNames();
                    ruleNames.forEach(ruleName => {
                        this.ruleEngine.deleteRule(ruleName);
                    });

                    // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑËßÑÂàôÊï∞ÊçÆ
                    localStorage.removeItem('wordFilterRules');
                    localStorage.removeItem('ruleOrder');

                    // Âà∑Êñ∞ÊòæÁ§∫
                    this.loadSavedRules();

                    this.showMessage('ÊâÄÊúâËßÑÂàôÂ∑≤Ê∏ÖÈô§', 'success');
                }
            }

            // ÊòæÁ§∫ËØ¶ÁªÜÂ∏ÆÂä©
            showDetailedHelp() {
                const detailedHelpModal = document.getElementById('detailedHelpModal');
                detailedHelpModal.style.display = 'flex';
            }

            // Ëé∑ÂèñÊâÄÊúâÂÖ®Â±ÄÈõÜÂêà
            getAllGlobalSets() {
                // Áõ¥Êé•‰ªéRuleEngineËé∑ÂèñÁúüÊ≠£ÁöÑÂÖ®Â±ÄÈõÜÂêà
                return this.ruleEngine.getGlobalSets();
            }

            /**
             * ÂØºÂá∫ËßÑÂàôÂà∞Êñá‰ª∂
             */
            async exportRules() {
                try {
                    const success = await this.ruleEngine.exportRulesToFile();
                    if (success) {
                        this.showMessage('ËßÑÂàôÂØºÂá∫ÊàêÂäüÔºÅ', 'success');
                    }
                } catch (error) {
                    if (error.name === 'AbortError') {
                        // Áî®Êà∑ÂèñÊ∂àÊìç‰ΩúÔºå‰∏çÊòæÁ§∫‰ªª‰ΩïÊ∂àÊÅØ
                        return;
                    }
                    console.error('ÂØºÂá∫ËßÑÂàôÂ§±Ë¥•:', error);
                    this.showMessage('ÂØºÂá∫ËßÑÂàôÂ§±Ë¥•: ' + error.message, 'error');
                }
            }

            /**
             * ‰ªéÊñá‰ª∂ÂØºÂÖ•ËßÑÂàô
             */
            importRules() {
                try {
                    this.ruleEngine.importRulesFromFile();

                    // ÁõëÂê¨ËßÑÂàôÊõ¥Êñ∞‰∫ã‰ª∂
                    window.addEventListener('rulesUpdated', () => {
                        this.loadSavedRules();
                        this.showMessage('ËßÑÂàôÂØºÂÖ•ÊàêÂäüÔºÅ', 'success');
                    }, { once: true });
                } catch (error) {
                    console.error('ÂØºÂÖ•ËßÑÂàôÂ§±Ë¥•:', error);
                    this.showMessage('ÂØºÂÖ•ËßÑÂàôÂ§±Ë¥•: ' + error.message, 'error');
                }
            }
        } // RuleManagerApp Á±ªÁªìÊùü

        // ÂàùÂßãÂåñÂ∫îÁî®
        let ruleManager;
        document.addEventListener('DOMContentLoaded', () => {
            ruleManager = new RuleManagerApp();
        });

        // ÂÖ®Â±ÄÂ§çÂà∂ÂáΩÊï∞
        function copyExample(button) {
            const codeBlock = button.parentElement;

            // ÂÖãÈöÜ‰ª£Á†ÅÂùó‰ª•ÈÅøÂÖç‰øÆÊîπÂéüÂßãÂÜÖÂÆπ
            const clonedBlock = codeBlock.cloneNode(true);

            // ‰ªéÂÖãÈöÜÁöÑÂùó‰∏≠ÁßªÈô§Â§çÂà∂ÊåâÈíÆ
            const clonedButton = clonedBlock.querySelector('button');
            if (clonedButton) {
                clonedButton.remove();
            }

            // Ëé∑ÂèñÁ∫ØÊñáÊú¨ÂÜÖÂÆπ
            const textToCopy = clonedBlock.textContent.trim();

            if (!textToCopy) {
                button.textContent = 'Êó†ÂÜÖÂÆπ';
                setTimeout(() => {
                    button.textContent = 'Â§çÂà∂';
                }, 2000);
                return;
            }

            // Â∞ùËØï‰ΩøÁî®Áé∞‰ª£ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    button.textContent = 'Â∑≤Â§çÂà∂';
                    setTimeout(() => {
                        button.textContent = 'Â§çÂà∂';
                    }, 2000);
                }).catch(err => {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                    fallbackCopy(textToCopy, button);
                });
            } else {
                // ÈôçÁ∫ßÂà∞‰º†ÁªüÊñπÊ≥ï
                fallbackCopy(textToCopy, button);
            }
        }

        function fallbackCopy(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                button.textContent = 'Â∑≤Â§çÂà∂';
            } catch (err) {
                console.error('Â§çÂà∂Â§±Ë¥•:', err);
                button.textContent = 'Â§çÂà∂Â§±Ë¥•';
            }

            document.body.removeChild(textArea);
            setTimeout(() => {
                button.textContent = 'Â§çÂà∂';
            }, 2000);
        }
    </script>
</body>

</html>